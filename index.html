<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyseur de Crash | Dashboard IA Pr√©dictif</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #4361ee;
            --primary-light: #4895ef;
            --primary-dark: #3f37c9;
            --secondary-color: #f72585;
            --success-color: #4cc9f0;
            --warning-color: #f8961e;
            --danger-color: #ef476f;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --gray-color: #6c757d;
            --background-color: #f5f7fa;
            --card-color: #ffffff;
            --border-radius: 12px;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s ease;
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --background-color: #1a1a1a;
                --card-color: #2d2d2d;
                --dark-color: #f8f9fa;
                --light-color: #212529;
            }
        }

        .dark {
            --background-color: #1a1a1a;
            --card-color: #2d2d2d;
            --dark-color: #f8f9fa;
            --light-color: #212529;
        }

        /* Notification */
        .notification {
            position: fixed;
            bottom: 30px;
            left: -300px;
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            transition: all 0.5s ease;
            z-index: 1000;
            opacity: 0;
            max-width: 350px;
            word-break: break-word;
        }

        button {
            -webkit-tap-highlight-color: transparent;
            outline: none;
            box-shadow: none;
            user-select: none;
            -webkit-user-select: none;
            -webkit-appearance: none;
            appearance: none;
            background-color: #007bff;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-family: inherit;
            cursor: pointer;
            transition: transform 0.1s ease-in-out;
        }

        button:focus,
        button:active,
        button:hover {
            background-color: #007bff;
            outline: none;
            box-shadow: none;
        }

        button:active {
            transform: scale(0.99);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--dark-color);
            min-height: 100vh;
            position: relative;
        }

        /* Login Overlay */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.9), rgba(63, 55, 201, 0.9));
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .login-card {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            padding: 2rem;
            width: 100%;
            max-width: 420px;
            animation: fadeIn 0.5s ease-out;
        }

        .login-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .login-header i {
            font-size: 2rem;
            margin-right: 1rem;
            color: var(--primary-color);
        }

        .login-header h2 {
            color: var(--primary-color);
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--gray-color);
        }

        .input-wrapper {
            position: relative;
        }

        .input-wrapper i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-color);
        }

        .input-wrapper input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background-color: var(--card-color);
            color: var(--dark-color);
        }

        .input-wrapper input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.25);
        }

        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 500;
            text-align: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .primary-btn {
            background-color: var(--primary-color);
            color: white;
        }

        .primary-btn:hover {
            background-color: var(--primary-dark);
        }
        
        .btn-secondary {
            background-color: var(--gray-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #7f8c8d;
        }

        .secondary-btn {
            background-color: var(--secondary-color);
            color: white;
        }

        .secondary-btn:hover {
            background-color: #d61d74;
        }

        .full-width {
            width: 100%;
        }

        .error-message {
            color: var(--danger-color);
            margin-top: 0.5rem;
            font-size: 0.875rem;
            display: none;
        }

        /* Volume slider styling */
        #soundVolume {
            -webkit-appearance: none;
            height: 6px;
            border-radius: 3px;
            background: #e2e8f0;
            outline: none;
        }

        #soundVolume::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
        }

        #soundVolume::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            border: none;
        }

        /* Connection Status */
        .connection-status {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.875rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 200;
            transition: var(--transition);
        }

        .connection-status.connected {
            background-color: rgba(46, 204, 113, 0.1);
            color: #2ecc71;
            border: 1px solid rgba(46, 204, 113, 0.3);
        }

        .connection-status.disconnected {
            background-color: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .connection-status.connecting {
            background-color: rgba(52, 152, 219, 0.1);
            color: #3498db;
            border: 1px solid rgba(52, 152, 219, 0.3);
        }

        /* Coefficient display */
        .coefficient-display {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            z-index: 200;
            min-width: 120px;
            font-weight: 600;
            cursor: move;
            user-select: none;
            transition: box-shadow 0.2s ease;
        }

        .coefficient-display:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .coefficient-display.dragging {
            opacity: 0.8;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            transform: scale(1.05);
        }

        .coefficient-label {
            font-size: 0.75rem;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .coefficient-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .coefficient-display.pulsing {
            animation: pulse 0.8s ease-in-out;
        }

        /* Header */
        header {
            background-color: var(--card-color);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .logo {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .solde {
            background-color: rgba(67, 97, 238, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-weight: 500;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-info i {
            font-size: 1.25rem;
            color: var(--primary-color);
        }

        #logoutBtn {
            background: none;
            border: none;
            color: var(--gray-color);
            font-size: 1rem;
            padding: 0.25rem;
            border-radius: 50%;
        }

        #logoutBtn:hover {
            color: var(--danger-color);
            background-color: rgba(239, 71, 111, 0.1);
        }

        /* Main Layout */
        .dashboard-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            grid-gap: 1.5rem;
            padding: 1.5rem;
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .panel {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .panel:hover {
            box-shadow: var(--shadow-lg);
        }

        .panel h3 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            color: var(--primary-color);
            font-weight: 600;
            font-size: 1.25rem;
        }

        .input-group {
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-group input {
            width: 100%;
            padding: 0.75rem 3rem 0.75rem 1rem;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background-color: var(--card-color);
            color: var(--dark-color);
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.25);
        }

        .input-suffix {
            position: absolute;
            right: 1rem;
            color: var(--gray-color);
            font-size: 0.875rem;
        }

        .switch-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Bet Panel */
        .bet-panel {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
        }

        .bet-panel h3 {
            color: white;
        }

        .bet-panel label {
            color: rgba(255, 255, 255, 0.8);
        }

        .bet-panel .input-group input {
            background-color: rgba(255, 255, 255, 0.15);
            border-color: transparent;
            color: white;
        }

        .bet-panel .input-suffix {
            color: rgba(255, 255, 255, 0.8);
        }

        .bet-panel .btn {
            background-color: white;
            color: var(--primary-color);
            font-weight: 600;
            margin-top: 1rem;
        }

        .bet-panel .btn:hover {
            background-color: rgba(255, 255, 255, 0.9);
        }

        /* Settings Panel */
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .toggle-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            font-size: 1rem;
            padding: 0.25rem;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toggle-btn:hover {
            background-color: rgba(67, 97, 238, 0.1);
        }

        .panel-content {
            overflow: hidden;
            max-height: 800px;
            transition: max-height 0.3s ease;
        }

        .collapsed .panel-content {
            max-height: 0;
        }

        .color-picker-wrapper {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .color-preview {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid #e2e8f0;
        }

        .settings-panel {
            min-height: auto;
        }

        .settings-panel .panel-content {
            overflow-y: auto;
        }

        /* Chart Panel */
        .chart-panel {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            transition: var(--transition);
        }

        .chart-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .chart-controls select {
            padding: 0.5rem 1rem;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            background-color: var(--card-color);
            color: var(--dark-color);
            font-size: 0.9rem;
            min-width: 150px;
        }

        .chart-controls select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.25);
        }

        .range-stats-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .range-stat-card {
            background-color: rgba(67, 97, 238, 0.05);
            border-radius: var(--border-radius);
            padding: 1rem;
            border: 1px solid rgba(67, 97, 238, 0.1);
        }

        .range-stat-title {
            font-size: 0.875rem;
            color: var(--gray-color);
            margin-bottom: 0.5rem;
        }

        .range-stat-value {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.25rem;
        }

        .range-stat-difference {
            font-size: 0.875rem;
            font-weight: 500;
        }

        .range-stat-difference.positive {
            color: var(--success-color);
        }

        .range-stat-difference.negative {
            color: var(--danger-color);
        }

        .range-stat-difference.neutral {
            color: var(--gray-color);
        }

        /* üîç STYLES POUR L'ANALYSE DES PICS ET CREUX */
        .pics-creux-section {
            background-color: rgba(76, 204, 240, 0.05);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 1px solid rgba(76, 204, 240, 0.2);
            box-shadow: 0 8px 32px rgba(76, 204, 240, 0.15), 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        /* üî• STYLES POUR L'ANALYSE DES CHUTES ET MONT√âES */
        .chutes-montee-section {
            background-color: rgba(247, 37, 133, 0.05);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 1px solid rgba(247, 37, 133, 0.2);
            box-shadow: 0 8px 32px rgba(247, 37, 133, 0.15), 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        /* üÜï NOUVEAUX STYLES POUR L'ANALYSE DES PICS ET CREUX L√âGERS */
        .pics-creux-legers-section {
            background-color: rgba(155, 89, 182, 0.05);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 1px solid rgba(155, 89, 182, 0.2);
            box-shadow: 0 8px 32px rgba(155, 89, 182, 0.15), 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        /* üî• NOUVEAUX STYLES POUR L'ANALYSE DES PLATEAUX */
        .plateaux-section {
            background-color: rgba(127, 140, 141, 0.05);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 1px solid rgba(127, 140, 141, 0.2);
            box-shadow: 0 8px 32px rgba(127, 140, 141, 0.15), 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        /* üå°Ô∏è NOUVEAUX STYLES POUR LE THERMOM√àTRE DE SITUATION */
        .thermometre-section {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.08), rgba(241, 196, 15, 0.08), rgba(46, 204, 113, 0.08));
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 2px solid transparent;
            background-clip: padding-box;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15), 0 4px 16px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .thermometre-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #e74c3c, #f1c40f, #2ecc71);
            z-index: -1;
            margin: -2px;
            border-radius: inherit;
        }

        .thermometre-gauge {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .gauge-container {
            flex: 1;
            position: relative;
            height: 40px;
            background: linear-gradient(to right, #e74c3c 0%, #f1c40f 50%, #2ecc71 100%);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .gauge-indicator {
            position: absolute;
            top: -5px;
            bottom: -5px;
            width: 4px;
            background-color: #fff;
            border-radius: 2px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
            transition: left 0.3s ease;
            z-index: 2;
        }

        .gauge-indicator::before {
            content: '';
            position: absolute;
            top: -8px;
            left: -6px;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 12px solid #fff;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .gauge-label {
            font-size: 0.75rem;
            color: var(--gray-color);
            margin-bottom: 0.25rem;
        }

        .gauge-percentage {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .thermometre-zones {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .zone-card {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease;
        }

        .zone-card:hover {
            transform: translateY(-2px);
        }

        .zone-card.negative {
            border-left: 4px solid #e74c3c;
        }

        .zone-card.stability {
            border-left: 4px solid #f1c40f;
        }

        .zone-card.positive {
            border-left: 4px solid #2ecc71;
        }

        .zone-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .zone-icon.negative {
            color: #e74c3c;
        }

        .zone-icon.stability {
            color: #f1c40f;
        }

        .zone-icon.positive {
            color: #2ecc71;
        }

        .zone-title {
            font-size: 0.8rem;
            color: var(--gray-color);
            margin-bottom: 0.25rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .zone-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .zone-value.negative {
            color: #e74c3c;
        }

        .zone-value.stability {
            color: #f1c40f;
        }

        .zone-value.positive {
            color: #2ecc71;
        }

        .zone-details {
            font-size: 0.75rem;
            color: var(--gray-color);
        }

        .thermometre-repartition {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 1rem;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .repartition-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.75rem;
        }

        .repartition-item {
            text-align: center;
            padding: 0.75rem 0.5rem;
            border-radius: 6px;
            background-color: rgba(67, 97, 238, 0.05);
            border: 1px solid rgba(67, 97, 238, 0.1);
        }

        .repartition-icon {
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }

        .repartition-icon.pics {
            color: #e74c3c;
        }

        .repartition-icon.creux {
            color: #3498db;
        }

        .repartition-icon.pics-legers {
            color: #9b59b6;
        }

        .repartition-icon.creux-legers {
            color: #8e44ad;
        }

        .repartition-icon.montees {
            color: #27ae60;
        }

        .repartition-icon.chutes {
            color: #e67e22;
        }

        .repartition-icon.stabilite {
            color: #f1c40f;
        }

        .repartition-label {
            font-size: 0.7rem;
            color: var(--gray-color);
            margin-bottom: 0.25rem;
        }

        .repartition-count {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        /* üìä NOUVEAUX STYLES POUR LE CLASSEMENT DES POURCENTAGES */
        .classement-section {
            background: linear-gradient(135deg, rgba(156, 39, 176, 0.08), rgba(103, 58, 183, 0.08));
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 2px solid transparent;
            background-clip: padding-box;
            box-shadow: 0 8px 32px rgba(156, 39, 176, 0.15), 0 4px 16px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .classement-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #9c27b0, #673ab7);
            z-index: -1;
            margin: -2px;
            border-radius: inherit;
        }

        .classement-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid rgba(0, 0, 0, 0.05);
            flex-wrap: wrap;
        }

        .search-percentage {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .search-percentage input {
            width: 100px;
            padding: 0.5rem;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            background-color: var(--card-color);
            color: var(--dark-color);
        }

        .search-btn {
            background-color: #9c27b0;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .search-btn:hover {
            background-color: #7b1fa2;
        }

        .classement-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .classement-stat-card {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease;
        }

        .classement-stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .classement-stat-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .classement-stat-icon.ranking {
            color: #9c27b0;
        }

        .classement-stat-icon.frequency {
            color: #673ab7;
        }

        .classement-stat-icon.stability {
            color: #3f51b5;
        }

        .classement-stat-icon.mode {
            color: #2196f3;
        }

        .classement-stat-title {
            font-size: 0.8rem;
            color: var(--gray-color);
            margin-bottom: 0.25rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .classement-stat-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 0.25rem;
        }

        .classement-stat-subtitle {
            font-size: 0.75rem;
            color: var(--gray-color);
        }

        .top-percentages {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .top-percentages-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .percentage-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            border-radius: 6px;
            background-color: rgba(156, 39, 176, 0.05);
            border: 1px solid rgba(156, 39, 176, 0.1);
            transition: transform 0.2s ease;
        }

        .percentage-item:hover {
            transform: scale(1.02);
            background-color: rgba(156, 39, 176, 0.1);
        }

        .percentage-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .percentage-value {
            font-weight: 600;
            color: #9c27b0;
            font-size: 1rem;
        }

        .percentage-details {
            font-size: 0.7rem;
            color: var(--gray-color);
        }

        .percentage-rank {
            background-color: #9c27b0;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 50px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .category-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .category-badge.ultra-frequent {
            background-color: rgba(76, 175, 80, 0.2);
            color: #4caf50;
        }

        .category-badge.tres-frequent {
            background-color: rgba(139, 195, 74, 0.2);
            color: #8bc34a;
        }

        .category-badge.frequent {
            background-color: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        .category-badge.modere {
            background-color: rgba(255, 152, 0, 0.2);
            color: #ff9800;
        }

        .category-badge.rare {
            background-color: rgba(255, 87, 34, 0.2);
            color: #ff5722;
        }

        .category-badge.ultra-rare {
            background-color: rgba(244, 67, 54, 0.2);
            color: #f44336;
        }

        .search-results {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 1rem;
            border: 1px solid rgba(0, 0, 0, 0.05);
            margin-top: 1rem;
            display: none;
        }

        .search-results.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* üéØ NOUVEAUX STYLES POUR LES PR√âDICTIONS IA */
        .prediction-section {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.08), rgba(155, 89, 182, 0.08), rgba(52, 152, 219, 0.08));
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 2px solid transparent;
            background-clip: padding-box;
            box-shadow: 0 8px 32px rgba(231, 76, 60, 0.15), 0 4px 16px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .prediction-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #e74c3c, #9b59b6, #3498db);
            z-index: -1;
            margin: -2px;
            border-radius: inherit;
        }

        .prediction-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid rgba(0, 0, 0, 0.05);
            flex-wrap: wrap;
        }

        .main-recommendation {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .main-recommendation-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: 8px;
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.1), rgba(155, 89, 182, 0.1));
            border: 2px solid rgba(231, 76, 60, 0.2);
            min-height: 80px;
        }

        .recommendation-icon {
            font-size: 2rem;
            color: #e74c3c;
            min-width: 60px;
            text-align: center;
        }

        .recommendation-content {
            flex: 1;
        }

        .recommendation-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #e74c3c;
            margin-bottom: 0.25rem;
        }

        .recommendation-subtitle {
            font-size: 0.9rem;
            color: var(--gray-color);
            margin-bottom: 0.5rem;
        }

        .recommendation-action {
            font-size: 1rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .probability-badge {
            background-color: #e74c3c;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 700;
            min-width: 80px;
            text-align: center;
        }

        .detailed-predictions {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .predictions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .prediction-card {
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            padding: 1rem;
            border-left: 4px solid;
            transition: transform 0.2s ease;
        }

        .prediction-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .prediction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .prediction-range-name {
            font-weight: 600;
            color: var(--dark-color);
        }

        .prediction-probability {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
            padding: 0.25rem 0.5rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .prediction-confidence {
            font-size: 0.75rem;
            color: var(--gray-color);
            margin-bottom: 0.5rem;
        }

        .prediction-reasoning {
            font-size: 0.8rem;
            color: var(--dark-color);
        }

        .prediction-reasoning ul {
            margin: 0;
            padding-left: 1rem;
        }

        .prediction-reasoning li {
            margin-bottom: 0.25rem;
        }

        .model-metrics {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 1rem;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .model-metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .model-metric-card {
            background-color: rgba(67, 97, 238, 0.05);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            border: 1px solid rgba(67, 97, 238, 0.1);
        }

        .model-metric-title {
            font-size: 0.75rem;
            color: var(--gray-color);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .model-metric-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .trend-global-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .trend-stat-card {
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            border: 1px solid rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }

        .trend-stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .trend-stat-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .trend-stat-icon.pic {
            color: #e74c3c;
        }

        .trend-stat-icon.creux {
            color: #3498db;
        }

        .trend-stat-icon.tendance {
            color: var(--primary-color);
        }

        .trend-stat-icon.variabilite {
            color: var(--warning-color);
        }

        .trend-stat-icon.chute {
            color: #e74c3c;
        }

        .trend-stat-icon.montee {
            color: #27ae60;
        }

        .trend-stat-icon.pic-leger {
            color: #9b59b6;
        }

        .trend-stat-icon.creux-leger {
            color: #8e44ad;
        }

        .trend-stat-icon.stabilite {
            color: #34495e;
        }

        .trend-stat-icon.plateau {
            color: #7f8c8d;
        }

        .trend-stat-icon.plateau-stable {
            color: #95a5a6;
        }

        .trend-stat-icon.plateau-activite {
            color: #34495e;
        }

        .trend-stat-icon.plateau-stabilite {
            color: #2c3e50;
        }

        .trend-stat-icon.thermometre {
            color: #e74c3c;
        }

        .trend-stat-icon.equilibre {
            color: #f39c12;
        }

        .trend-stat-icon.zone-negative {
            color: #e74c3c;
        }

        .trend-stat-icon.zone-positive {
            color: #2ecc71;
        }

        .trend-stat-icon.ranking {
            color: #9c27b0;
        }

        .trend-stat-icon.frequency {
            color: #673ab7;
        }

        .trend-stat-title {
            font-size: 0.8rem;
            color: var(--gray-color);
            margin-bottom: 0.25rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .trend-stat-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 0.25rem;
        }

        .trend-stat-subtitle {
            font-size: 0.75rem;
            color: var(--gray-color);
        }

        .trend-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .trend-badge.piquante {
            background-color: rgba(39, 174, 96, 0.2);
            color: #27ae60;
        }

        .trend-badge.creusante {
            background-color: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }

        .trend-badge.baissiere {
            background-color: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }

        .trend-badge.haussiere {
            background-color: rgba(39, 174, 96, 0.2);
            color: #27ae60;
        }

        .trend-badge.neutre {
            background-color: rgba(108, 117, 125, 0.2);
            color: var(--gray-color);
        }

        .trend-badge.pics-legers-dominants {
            background-color: rgba(39, 174, 96, 0.2);
            color: #27ae60;
        }

        .trend-badge.creux-legers-dominants {
            background-color: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }

        .trend-badge.globalement-stable {
            background-color: rgba(39, 174, 96, 0.2);
            color: #27ae60;
        }

        .trend-badge.plut√¥t-stable {
            background-color: rgba(52, 152, 219, 0.2);
            color: #3498db;
        }

        .trend-badge.mod√©r√©ment-dynamique {
            background-color: rgba(241, 196, 15, 0.2);
            color: #f1c40f;
        }

        .trend-badge.tr√®s-dynamique {
            background-color: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }

        .trend-badge.stabilit√©-dominante {
            background-color: rgba(39, 174, 96, 0.2);
            color: #27ae60;
        }

        .trend-badge.dynamisme-dominant {
            background-color: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }

        .trend-badge.√©quilibr√©e {
            background-color: rgba(108, 117, 125, 0.2);
            color: var(--gray-color);
        }

        .trend-badge.tr√®s-positive {
            background-color: rgba(39, 174, 96, 0.3);
            color: #27ae60;
        }

        .trend-badge.positive {
            background-color: rgba(39, 174, 96, 0.2);
            color: #27ae60;
        }

        .trend-badge.n√©gative {
            background-color: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }

        .trend-badge.tr√®s-n√©gative {
            background-color: rgba(231, 76, 60, 0.3);
            color: #e74c3c;
        }

        .trend-badge.tr√®s-stable {
            background-color: rgba(241, 196, 15, 0.3);
            color: #f39c12;
        }

        .trend-badge.tr√®s-concentr√© {
            background-color: rgba(156, 39, 176, 0.3);
            color: #9c27b0;
        }

        .trend-badge.concentr√© {
            background-color: rgba(156, 39, 176, 0.2);
            color: #9c27b0;
        }

        .trend-badge.mod√©r√©ment-concentr√© {
            background-color: rgba(103, 58, 183, 0.2);
            color: #673ab7;
        }

        .trend-badge.l√©g√®rement-concentr√© {
            background-color: rgba(63, 81, 181, 0.2);
            color: #3f51b5;
        }

        .trend-badge.√©quilibr√© {
            background-color: rgba(33, 150, 243, 0.2);
            color: #2196f3;
        }

        .recent-events {
            background-color: rgba(255, 255, 255, 0.6);
            border-radius: 8px;
            padding: 1rem;
        }

        .events-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .event-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            border: 1px solid;
            transition: transform 0.2s ease;
        }

        .event-badge:hover {
            transform: scale(1.05);
        }

        .event-badge.pic {
            background-color: rgba(231, 76, 60, 0.1);
            border-color: rgba(231, 76, 60, 0.3);
            color: #e74c3c;
        }

        .event-badge.creux {
            background-color: rgba(52, 152, 219, 0.1);
            border-color: rgba(52, 152, 219, 0.3);
            color: #3498db;
        }

        .event-badge.pic-leger {
            background-color: rgba(39, 174, 96, 0.1);
            border-color: rgba(39, 174, 96, 0.3);
            color: #27ae60;
        }

        .event-badge.creux-leger {
            background-color: rgba(231, 76, 60, 0.1);
            border-color: rgba(231, 76, 60, 0.3);
            color: #e74c3c;
        }

        .plateau-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            border: 1px solid;
            transition: transform 0.2s ease;
            background-color: rgba(127, 140, 141, 0.1);
            border-color: rgba(127, 140, 141, 0.3);
            color: #7f8c8d;
        }

        .plateau-badge:hover {
            transform: scale(1.05);
        }

        .movement-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            border: 1px solid;
            transition: transform 0.2s ease;
        }

        .movement-badge:hover {
            transform: scale(1.05);
        }

        .movement-badge.chute {
            background-color: rgba(231, 76, 60, 0.1);
            border-color: rgba(231, 76, 60, 0.3);
            color: #e74c3c;
        }

        .movement-badge.montee {
            background-color: rgba(39, 174, 96, 0.1);
            border-color: rgba(39, 174, 96, 0.3);
            color: #27ae60;
        }

        .event-details {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.1rem;
        }

        .movement-details {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.1rem;
        }

        .event-value {
            font-weight: 600;
        }

        .movement-variation {
            font-weight: 600;
        }

        .event-intensity {
            font-size: 0.7rem;
            opacity: 0.8;
        }

        .movement-length {
            font-size: 0.7rem;
            opacity: 0.8;
        }

        .light-event-details {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.1rem;
        }

        .plateau-length {
            font-size: 0.7rem;
            opacity: 0.8;
        }

        .stability-info {
            font-size: 0.7rem;
            opacity: 0.8;
        }

        .plateau-details {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.1rem;
        }

        .plateau-info {
            font-size: 0.7rem;
            opacity: 0.8;
        }

        .no-events-message {
            text-align: center;
            color: var(--gray-color);
            font-style: italic;
            padding: 1rem;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 1rem;
        }

        .chart-legend {
            display: flex;
            align-items: center;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .wide-panel {
            width: 100%;
        }

        .panel-header {
            margin-bottom: 1.5rem;
        }

        .timestamp {
            color: var(--gray-color);
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .stat-subvalue {
            font-size: 0.8rem;
            color: var(--gray-color);
            margin-top: 0.25rem;
        }

        .stat-subvalue small {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .stat-subvalue span {
            font-weight: 500;
            color: var(--primary-color);
        }

        #resetStatsBtn {
            margin-top: 0.5rem;
            background-color: var(--danger-color);
        }

        #resetStatsBtn:hover {
            background-color: #d63031;
        }

        .stat-card {
            background-color: rgba(67, 97, 238, 0.05);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            position: relative;
            border: 1px solid rgba(67, 97, 238, 0.1);
        }

        .stat-icon {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            color: var(--primary-color);
            opacity: 0.3;
        }

        .stat-info {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .stat-title {
            font-size: 0.875rem;
            color: var(--gray-color);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .inline-form {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0;
        }

        .inline-form label {
            margin-bottom: 0;
            white-space: nowrap;
        }

        .inline-form input {
            width: 70px;
            padding: 0.25rem 0.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            background-color: var(--card-color);
            color: var(--dark-color);
        }

        .history-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .total-count {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary-color);
            font-weight: 500;
            font-size: 0.9rem;
        }

        /* Ranges Section */
        .ranges-container {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .ranges-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .ranges-header h3 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary-color);
            font-weight: 600;
            font-size: 1.25rem;
            margin: 0;
        }

        .ranges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
        }

        .range-card {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            padding: 1rem;
            border: 1px solid #e2e8f0;
            transition: var(--transition);
        }

        .range-card:hover {
            box-shadow: var(--shadow);
            transform: translateY(-2px);
        }

        .range-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .range-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
        }

        .range-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .range-delete {
            background: none;
            border: none;
            color: var(--gray-color);
            font-size: 0.875rem;
            padding: 0.25rem;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .range-delete:hover {
            color: var(--danger-color);
            background-color: rgba(239, 71, 111, 0.1);
        }

        .range-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .range-stat {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .range-stat span:first-child {
            font-size: 0.75rem;
            color: var(--gray-color);
        }

        .range-stat span:last-child {
            font-weight: 500;
        }

        .range-progress {
            height: 6px;
            background-color: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
        }

        .range-progress-bar {
            height: 100%;
            transition: width 0.3s ease;
        }

        /* History Section */
        .history-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .history-controls select {
            padding: 0.25rem 0.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            background-color: var(--card-color);
            color: var(--dark-color);
        }

        .history-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 0.5rem;
        }

        .history-item {
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 8px;
            font-weight: 500;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }

        .history-item:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .history-pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
        }

        .page-info {
            font-size: 0.875rem;
            color: var(--gray-color);
        }

        .pagination-controls {
            display: flex;
            gap: 0.5rem;
        }

        .pagination-btn {
            background-color: var(--light-color);
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            color: var(--gray-color);
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .pagination-btn:hover {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .modal-header h3 {
            color: var(--primary-color);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0;
        }

        .close {
            font-size: 1.5rem;
            color: var(--gray-color);
            background: none;
            border: none;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover {
            color: var(--danger-color);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid #e2e8f0;
        }

        /* Floating Bet Button */
        .floating-bet-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: linear-gradient(135deg, var(--secondary-color), #d61d74);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            border: none;
            font-size: 1.5rem;
            z-index: 99;
            transition: transform 0.3s ease, background 0.3s ease;
        }

        .floating-bet-btn:hover {
            transform: translateY(-5px) scale(1.05);
            background: linear-gradient(135deg, #d61d74, var(--secondary-color));
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .connecting {
            animation: pulse 1.5s ease-in-out infinite;
        }

        /* Smooth transition for auto-updates */
        .auto-update {
            transition: all 0.3s ease;
        }

        .auto-update.updating {
            opacity: 0.8;
            transform: scale(0.98);
        }

        .toggle-password {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray-color);
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 50%;
        }

        .toggle-password:hover {
            background-color: rgba(67, 97, 238, 0.1);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .dashboard-container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            }

            .coefficient-display {
                top: 70px;
            }

            .ranges-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            }

            .trend-global-stats {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .thermometre-zones {
                grid-template-columns: 1fr;
            }

            .repartition-grid {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            }

            .classement-stats {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .top-percentages-grid {
                grid-template-columns: 1fr;
            }

            .predictions-grid {
                grid-template-columns: 1fr;
            }

            .model-metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .header-right {
                gap: 0.75rem;
            }
            
            .ranges-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-container {
                padding: 1rem;
            }

            .coefficient-display {
                position: relative;
                top: auto;
                right: auto;
                margin-bottom: 1rem;
                align-self: flex-start;
            }

            .connection-status {
                top: 10px;
                font-size: 0.75rem;
                padding: 0.25rem 0.75rem;
            }

            .chart-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .range-stats-display {
                grid-template-columns: 1fr;
            }

            .trend-global-stats {
                grid-template-columns: 1fr;
            }

            .events-list {
                flex-direction: column;
            }

            .thermometre-zones {
                grid-template-columns: 1fr;
            }

            .gauge-container {
                min-width: 200px;
            }

            .repartition-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .classement-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .classement-stats {
                grid-template-columns: 1fr;
            }

            .top-percentages-grid {
                grid-template-columns: 1fr;
            }

            .prediction-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .predictions-grid {
                grid-template-columns: 1fr;
            }

            .model-metrics-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            header {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }
            
            .header-right {
                width: 100%;
                justify-content: space-between;
            }
            
            .login-card {
                padding: 1.5rem;
                width: 90%;
            }

            .repartition-grid {
                grid-template-columns: 1fr;
            }

            .top-percentages-grid {
                grid-template-columns: 1fr;
            }

            .predictions-grid {
                grid-template-columns: 1fr;
            }

            .model-metrics-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Dark mode detector -->
    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>

    <!-- Indicateur de statut de connexion -->
    <div id="connectionStatus" class="connection-status disconnected">
        <i class="fas fa-wifi"></i>
        <span>D√©connect√©</span>
    </div>

    <!-- Affichage du coefficient en progression - D√âPLA√áABLE -->
    <div id="coefficientDisplay" class="coefficient-display" style="display: none;">
        <div class="coefficient-label">C√¥te actuelle</div>
        <div id="coefficientValue" class="coefficient-value">--</div>
    </div>

    <!-- Overlay de connexion -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-card">
            <div class="login-header">
                <i class="fas fa-chart-line"></i>
                <h2>Analyseur de Crash IA</h2>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Nom d'utilisateur</label>
                    <div class="input-wrapper">
                        <i class="fas fa-user"></i>
                        <input type="text" id="username" placeholder="admin" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="password">Mot de passe</label>
                    <div class="input-wrapper">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                </div>
                <button type="submit" id="loginBtn" class="btn primary-btn full-width">Connexion</button>
                <div id="loginError" class="error-message"></div>
            </form>
        </div>
    </div>

    <!-- Header avec solde et utilisateur -->
    <header>
        <div class="header-left">
            <div class="logo"><i class="fas fa-brain"></i> Analyseur de Crash IA Pr√©dictif</div>
        </div>
        <div class="header-right">
            <div id="soldeAffichage" class="solde"><i class="fas fa-coins"></i> <span>-- FCFA</span></div>
            <div class="user-info">
                <i class="fas fa-user-circle"></i>
                <span id="usernameDisplay">Utilisateur</span>
                <button id="logoutBtn" title="D√©connexion"><i class="fas fa-sign-out-alt"></i></button>
            </div>
        </div>
    </header>

    <!-- Conteneur principal -->
    <div class="dashboard-container">
        <!-- Panneau de contr√¥le lat√©ral -->
        <div class="sidebar">
            <!-- Contr√¥les g√©n√©raux -->
            <div class="panel">
                <h3><i class="fas fa-sliders-h"></i> Contr√¥les</h3>
                <div class="form-group">
                    <label for="historySize">Taille de l'historique</label>
                    <div class="input-group">
                        <input type="number" id="historySize" min="10" max="10000" value="1000">
                        <span class="input-suffix">valeurs</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="pollingFreq">Fr√©quence de mise √† jour</label>
                    <div class="input-group">
                        <input type="number" id="pollingFreq" min="500" max="10000" step="100" value="1000">
                        <span class="input-suffix">ms</span>
                    </div>
                </div>
                <div class="form-group switch-group">
                    <label for="pollingToggle">Mise √† jour automatique</label>
                    <label class="switch">
                        <input type="checkbox" id="pollingToggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <!-- Formulaire de pari -->
            <div class="panel bet-panel">
                <h3><i class="fas fa-coins"></i> Placer un pari</h3>
                <div class="form-group">
                    <label for="betAmount">Montant</label>
                    <div class="input-group">
                        <input type="number" id="betAmount" min="1" value="100" step="1">
                        <span class="input-suffix">FCFA</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="autoCashout">Auto Cashout</label>
                    <div class="input-group">
                        <input type="number" id="autoCashout" min="1.01" step="0.01" value="2.00">
                        <span class="input-suffix">x</span>
                    </div>
                </div>
                <button id="placeBetBtn" class="btn primary-btn full-width"><i class="fas fa-play"></i> Placer le pari</button>
            </div>

            <!-- Param√®tres avanc√©s avec notifications sonores -->
            <div class="panel settings-panel collapsed">
                <div class="panel-header">
                    <h3><i class="fas fa-cog"></i> Param√®tres avanc√©s</h3>
                    <button id="toggleSettings" class="toggle-btn"><i class="fas fa-chevron-down"></i></button>
                </div>
                <div class="panel-content">
                    <div class="form-group">
                        <label for="authToken">Auth Token</label>
                        <div class="input-wrapper">
                            <i class="fas fa-key"></i>
                            <input type="password" id="authToken" value="70eb6339151ce50386c914434b5d0679a3ecc3689f54f5146891dae7a83814f6cc661e4127af348615d5dde04f297a31446359e96c4c8de817ec37ecb737953090659cc69f00e0fd9badacd28c8a67e15422e30dfb558da3fd78f4d9ff44b7fbc20d15bb185a8667b5636adef9c4273b70d542c4a69d0019a91915e050451e928f86d02132787a9827f309436b8916a5ed418de1691f070475babbbf.1c071e6410d9d5628a0157cd70b4eff4.077dee8d-c923-4c02-9bee-757573662e69">
                            <button type="button" class="toggle-password" title="Afficher/Masquer"><i class="fas fa-eye"></i></button>
                        </div>
                    </div>
                    
                    <div class="form-group switch-group">
                        <label for="soundNotifications">Notifications sonores</label>
                        <label class="switch">
                            <input type="checkbox" id="soundNotifications" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label for="soundVolume">Volume des notifications</label>
                        <div class="input-group">
                            <input type="range" id="soundVolume" min="0" max="100" value="50" style="width: 100%;">
                            <span class="input-suffix" id="volumeDisplay">50%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Zone principale -->
        <div class="main-content">
            <!-- Statistiques g√©n√©rales -->
            <div class="panel wide-panel">
                <div class="panel-header">
                    <h3><i class="fas fa-chart-pie"></i> Statistiques g√©n√©rales</h3>
                    <div id="lastUpdated" class="timestamp"><i class="far fa-clock"></i> Mise √† jour: --:--:--</div>
                </div>
                <div class="stats-grid">
                    <!-- Carte M√©diane -->
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-sort-amount-up-alt"></i></div>
                        <div class="stat-info">
                            <div class="stat-title">M√©diane</div>
                            <div id="medianValue" class="stat-value">--</div>
                            <div class="stat-subvalue">
                                <small>Moyenne: <span id="medianAverageValue">--</span></small>
                            </div>
                        </div>
                        <div class="form-group inline-form">
                            <label for="medianSize">Taille:</label>
                            <input type="number" id="medianSize" min="10" max="1000" value="50">
                        </div>
                    </div>

                    <!-- Carte Moyenne -->
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-calculator"></i></div>
                        <div class="stat-info">
                            <div class="stat-title">Moyenne g√©n√©rale</div>
                            <div id="meanValue" class="stat-value">--</div>
                            <div class="stat-subvalue">
                                <small>Moyenne: <span id="meanAverageValue">--</span></small>
                            </div>
                        </div>
                        <div class="form-group inline-form">
                            <label for="meanSize">Taille:</label>
                            <input type="number" id="meanSize" min="10" max="1000" value="100">
                        </div>
                    </div>

                    <!-- Bouton de r√©initialisation -->
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-redo"></i></div>
                        <div class="stat-info">
                            <div class="stat-title">R√©initialisation</div>
                            <button id="resetStatsBtn" class="btn secondary-btn full-width">
                                <i class="fas fa-trash-alt"></i> R√©initialiser les stats
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- üîç SECTION : R√©sum√© global des tendances (mise √† jour) -->
            <div class="panel wide-panel auto-update" id="globalTrendPanel" style="display: none;">
                <div class="panel-header">
                    <h3><i class="fas fa-chart-area"></i> R√©sum√© global des tendances</h3>
                    <div class="timestamp" style="font-size: 0.8rem; color: var(--success-color);">
                        <i class="fas fa-sync-alt"></i> Analyse en temps r√©el
                    </div>
                </div>
                <div id="globalTrendDisplay" class="trend-global-stats">
                    <!-- Le r√©sum√© global appara√Ætra ici -->
                </div>
            </div>

            <!-- Analyse graphique des plages - Auto-refresh avec toutes les analyses -->
            <div class="chart-panel auto-update">
                <div class="panel-header">
                    <h3><i class="fas fa-chart-line"></i> Analyse graphique des plages <small style="color: #2ecc71; font-size: 0.7rem;">(Temps r√©el)</small></h3>
                </div>
                <div class="chart-controls">
                    <label for="rangeSelector">Plage √† analyser:</label>
                    <select id="rangeSelector">
                        <option value="">S√©lectionner une plage...</option>
                    </select>
                </div>
                <div id="rangeStatsDisplay" class="range-stats-display">
                    <!-- Les statistiques de la plage s√©lectionn√©e appara√Ætront ici -->
                </div>
                
                <!-- üîç SECTION : Analyse des pics et creux -->
                <div id="picsCreuxSection" class="pics-creux-section" style="display: none;">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-mountain"></i> Analyse des Pics et Creux
                    </h4>
                    
                    <!-- Statistiques globales de la tendance -->
                    <div id="trendGlobalStats" class="trend-global-stats">
                        <!-- Les stats globales appara√Ætront ici -->
                    </div>
                    
                    <!-- Derniers √©v√©nements d√©tect√©s -->
                    <div id="recentEvents" class="recent-events">
                        <h5 style="color: var(--gray-color); margin-bottom: 0.75rem; font-size: 0.9rem;">
                            <i class="fas fa-history"></i> Derniers √©v√©nements d√©tect√©s
                        </h5>
                        <div id="eventsList" class="events-list">
                            <!-- La liste des √©v√©nements appara√Ætra ici -->
                        </div>
                    </div>
                </div>

                <!-- üî• SECTION : Analyse des chutes et mont√©es progressives -->
                <div id="chutesMonteeSection" class="chutes-montee-section" style="display: none;">
                    <h4 style="color: var(--secondary-color); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-chart-area"></i> Analyse des Chutes et Mont√©es Progressives
                    </h4>
                    
                    <!-- Statistiques globales des mouvements -->
                    <div id="movementGlobalStats" class="trend-global-stats">
                        <!-- Les stats des mouvements appara√Ætront ici -->
                    </div>
                    
                    <!-- Derniers mouvements d√©tect√©s -->
                    <div id="recentMovements" class="recent-events">
                        <h5 style="color: var(--gray-color); margin-bottom: 0.75rem; font-size: 0.9rem;">
                            <i class="fas fa-history"></i> Derniers mouvements d√©tect√©s
                        </h5>
                        <div id="movementsList" class="events-list">
                            <!-- La liste des mouvements appara√Ætra ici -->
                        </div>
                    </div>
                </div>

                <!-- üÜï NOUVELLE SECTION : Analyse des pics et creux l√©gers -->
                <div id="picsCreuxLegersSection" class="pics-creux-legers-section" style="display: none;">
                    <h4 style="color: #9b59b6; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-wave-square"></i> Analyse des Pics et Creux L√©gers
                    </h4>
                    
                    <!-- Statistiques globales des pics et creux l√©gers -->
                    <div id="lightTrendGlobalStats" class="trend-global-stats">
                        <!-- Les stats des pics/creux l√©gers appara√Ætront ici -->
                    </div>
                    
                    <!-- Derniers √©v√©nements l√©gers d√©tect√©s -->
                    <div id="recentLightEvents" class="recent-events">
                        <h5 style="color: var(--gray-color); margin-bottom: 0.75rem; font-size: 0.9rem;">
                            <i class="fas fa-history"></i> Derniers √©v√©nements l√©gers d√©tect√©s
                        </h5>
                        <div id="lightEventsList" class="events-list">
                            <!-- La liste des √©v√©nements l√©gers appara√Ætra ici -->
                        </div>
                    </div>
                </div>

                <!-- üî• NOUVELLE SECTION : Analyse des plateaux -->
                <div id="plateauxSection" class="plateaux-section" style="display: none;">
                    <h4 style="color: #7f8c8d; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-chart-line"></i> Analyse des Plateaux de Stabilit√©
                    </h4>
                    
                    <!-- Statistiques globales des plateaux -->
                    <div id="plateauxGlobalStats" class="trend-global-stats">
                        <!-- Les stats des plateaux appara√Ætront ici -->
                    </div>
                    
                    <!-- Derniers plateaux d√©tect√©s -->
                    <div id="recentPlateaux" class="recent-events">
                        <h5 style="color: var(--gray-color); margin-bottom: 0.75rem; font-size: 0.9rem;">
                            <i class="fas fa-history"></i> Derniers plateaux d√©tect√©s
                        </h5>
                        <div id="plateauxList" class="events-list">
                            <!-- La liste des plateaux appara√Ætra ici -->
                        </div>
                    </div>
                </div>

                <!-- üå°Ô∏è NOUVELLE SECTION : Thermom√®tre de Situation -->
                <div id="thermometreSection" class="thermometre-section" style="display: none;">
                    <h4 style="color: #e74c3c; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-thermometer-half"></i> Thermom√®tre de Situation
                    </h4>
                    
                    <!-- Jauge thermom√®tre -->
                    <div id="thermometreGauge" class="thermometre-gauge">
                        <div style="min-width: 120px;">
                            <div class="gauge-label">√âquilibre Global</div>
                            <div id="equilibreValue" class="gauge-percentage">0%</div>
                        </div>
                        <div class="gauge-container">
                            <div id="gaugeIndicator" class="gauge-indicator" style="left: 50%;"></div>
                        </div>
                        <div style="min-width: 100px; text-align: right;">
                            <div class="gauge-label">Tendance</div>
                            <div id="tendanceThermometre" class="gauge-percentage" style="font-size: 0.9rem;">√âquilibr√©e</div>
                        </div>
                    </div>
                    
                    <!-- Zones n√©gatives, stabilit√© et positives -->
                    <div id="thermometreZones" class="thermometre-zones">
                        <div class="zone-card negative">
                            <div class="zone-icon negative"><i class="fas fa-arrow-down"></i></div>
                            <div class="zone-title">Zone N√©gative</div>
                            <div id="zoneNegativeValue" class="zone-value negative">0%</div>
                            <div id="zoneNegativeDetails" class="zone-details">Chutes, Creux, Creux l√©gers</div>
                        </div>
                        
                        <div class="zone-card stability">
                            <div class="zone-icon stability"><i class="fas fa-balance-scale"></i></div>
                            <div class="zone-title">Zone Stabilit√©</div>
                            <div id="zoneStabiliteValue" class="zone-value stability">0%</div>
                            <div id="zoneStabiliteDetails" class="zone-details">Plateaux de stabilit√©</div>
                        </div>
                        
                        <div class="zone-card positive">
                            <div class="zone-icon positive"><i class="fas fa-arrow-up"></i></div>
                            <div class="zone-title">Zone Positive</div>
                            <div id="zonePositiveValue" class="zone-value positive">0%</div>
                            <div id="zonePositiveDetails" class="zone-details">Mont√©es, Pics, Pics l√©gers</div>
                        </div>
                    </div>
                    
                    <!-- R√©partition d√©taill√©e des points -->
                    <div id="thermometreRepartition" class="thermometre-repartition">
                        <h5 style="color: var(--gray-color); margin-bottom: 0.75rem; font-size: 0.9rem;">
                            <i class="fas fa-chart-pie"></i> R√©partition des points d√©tect√©s
                        </h5>
                        <div id="repartitionGrid" class="repartition-grid">
                            <!-- La r√©partition appara√Ætra ici -->
                        </div>
                    </div>
                </div>

                <!-- üìä NOUVELLE SECTION : Classement des Pourcentages -->
                <div id="classementSection" class="classement-section" style="display: none;">
                    <h4 style="color: #9c27b0; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-ranking-star"></i> Classement des Pourcentages par Fr√©quence
                    </h4>
                    
                    <!-- Contr√¥les de recherche -->
                    <div id="classementControls" class="classement-controls">
                        <div class="search-percentage">
                            <label for="searchPercentageInput">Rechercher %:</label>
                            <input type="number" id="searchPercentageInput" step="0.1" placeholder="ex: 25.5">
                            <button id="searchPercentageBtn" class="search-btn">
                                <i class="fas fa-search"></i> Rechercher
                            </button>
                        </div>
                        <button id="showTopPercentagesBtn" class="search-btn">
                            <i class="fas fa-trophy"></i> Top 10
                        </button>
                        <button id="refreshClassementBtn" class="search-btn">
                            <i class="fas fa-sync-alt"></i> Actualiser
                        </button>
                    </div>
                    
                    <!-- Statistiques globales du classement -->
                    <div id="classementGlobalStats" class="classement-stats">
                        <!-- Les stats globales du classement appara√Ætront ici -->
                    </div>
                    
                    <!-- Top des pourcentages -->
                    <div id="topPercentages" class="top-percentages">
                        <h5 style="color: var(--gray-color); margin-bottom: 0.75rem; font-size: 0.9rem;">
                            <i class="fas fa-medal"></i> Top des pourcentages les plus fr√©quents
                        </h5>
                        <div id="topPercentagesList" class="top-percentages-grid">
                            <!-- La liste des top pourcentages appara√Ætra ici -->
                        </div>
                    </div>
                    
                    <!-- R√©sultats de recherche -->
                    <div id="searchResults" class="search-results">
                        <h5 style="color: var(--gray-color); margin-bottom: 0.75rem; font-size: 0.9rem;">
                            <i class="fas fa-search"></i> R√©sultats de recherche
                        </h5>
                        <div id="searchResultsList" class="top-percentages-grid">
                            <!-- Les r√©sultats de recherche appara√Ætront ici -->
                        </div>
                    </div>
                </div>

                <!-- üéØ NOUVELLE SECTION : Pr√©dictions de Crash IA -->
                <div id="predictionSection" class="prediction-section" style="display: none;">
                    <h4 style="color: #e74c3c; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-crystal-ball"></i> Pr√©dictions de Crash Intelligence Artificielle
                    </h4>
                    
                    <!-- Contr√¥les des pr√©dictions -->
                    <div id="predictionControls" class="prediction-controls">
                        <button id="refreshPredictionBtn" class="search-btn">
                            <i class="fas fa-sync-alt"></i> Actualiser Pr√©dictions
                        </button>
                        <button id="viewTransitionAnalysisBtn" class="search-btn">
                            <i class="fas fa-exchange-alt"></i> Analyse Transitions
                        </button>
                        <button id="viewMomentumAnalysisBtn" class="search-btn">
                            <i class="fas fa-rocket"></i> Analyse Momentum
                        </button>
                        <button id="clearPredictionHistoryBtn" class="search-btn">
                            <i class="fas fa-trash"></i> Effacer Historique
                        </button>
                    </div>
                    
                    <!-- Recommandation principale -->
                    <div id="mainRecommendation" class="main-recommendation">
                        <h5 style="color: var(--gray-color); margin-bottom: 0.75rem; font-size: 0.9rem;">
                            <i class="fas fa-bullseye"></i> Recommandation IA Principale
                        </h5>
                        <div id="mainRecommendationCard" class="main-recommendation-card">
                            <div class="recommendation-icon">
                                <i class="fas fa-brain"></i>
                            </div>
                            <div class="recommendation-content">
                                <div class="recommendation-title">Analyse en cours...</div>
                                <div class="recommendation-subtitle">Intelligence artificielle pr√©dictive</div>
                                <div class="recommendation-action">Veuillez patienter</div>
                            </div>
                            <div class="probability-badge">
                                --%
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pr√©dictions d√©taill√©es par range -->
                    <div id="detailedPredictions" class="detailed-predictions">
                        <h5 style="color: var(--gray-color); margin-bottom: 0.75rem; font-size: 0.9rem;">
                            <i class="fas fa-chart-line"></i> Pr√©dictions d√©taill√©es par Range
                        </h5>
                        <div id="predictionsList" class="predictions-grid">
                            <!-- Les pr√©dictions d√©taill√©es appara√Ætront ici -->
                        </div>
                    </div>
                    
                    <!-- M√©triques du mod√®le -->
                    <div id="modelMetrics" class="model-metrics">
                        <h5 style="color: var(--gray-color); margin-bottom: 0.75rem; font-size: 0.9rem;">
                            <i class="fas fa-cogs"></i> M√©triques du Mod√®le IA
                        </h5>
                        <div id="modelMetricsGrid" class="model-metrics-grid">
                            <!-- Les m√©triques du mod√®le appara√Ætront ici -->
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="rangeChart"></canvas>
                </div>
                <div class="chart-legend" id="chartLegend">
                    <!-- La l√©gende sera g√©n√©r√©e dynamiquement -->
                </div>
            </div>

            <!-- Analyse des plages -->
            <div class="ranges-container auto-update">
                <div class="ranges-header">
                    <h3><i class="fas fa-chart-bar"></i> Analyse des plages</h3>
                    <button id="addRangeBtn" class="btn secondary-btn">
                        <i class="fas fa-plus"></i> Ajouter une plage
                    </button>
                </div>
                <div id="rangesContainer" class="ranges-grid">
                    <!-- Les plages seront g√©n√©r√©es dynamiquement ici -->
                </div>
            </div>

            <!-- Historique des valeurs -->
            <div class="panel wide-panel auto-update">
                <div class="panel-header">
                    <h3><i class="fas fa-history"></i> Historique des valeurs</h3>
                    <div class="history-info">
                        <div class="total-count">
                            <i class="fas fa-list-ol"></i>
                            Total: <span id="totalValueCount">0</span> valeurs
                        </div>
                        <div class="history-controls">
                            <label for="itemsPerPage">Par page:</label>
                            <select id="itemsPerPage">
                                <option value="10">10</option>
                                <option value="20">20</option>
                                <option value="50" selected>50</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div id="historyValues" class="history-container">
                    <!-- Les valeurs d'historique seront g√©n√©r√©es dynamiquement ici -->
                </div>
                <div class="history-pagination">
                    <div class="page-info">Page <span id="currentPage">1</span> sur <span id="totalPages">1</span></div>
                    <div class="pagination-controls">
                        <button id="prevPageBtn" class="pagination-btn" disabled><i class="fas fa-chevron-left"></i> Pr√©c√©dent</button>
                        <button id="nextPageBtn" class="pagination-btn">Suivant <i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bouton flottant de pari -->
    <button id="floatingBetBtn" class="floating-bet-btn" title="Placer un pari rapide">
        <i class="fas fa-coins"></i>
    </button>

    <!-- Modal pour ajouter une plage -->
    <div id="rangeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-chart-bar"></i> Configurer une plage</h3>
                <button class="close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="rangeName">Nom de la plage</label>
                    <div class="input-wrapper">
                        <i class="fas fa-tag"></i>
                        <input type="text" id="rangeName" placeholder="ex: Valeurs basses">
                    </div>
                </div>
                <div class="form-group">
                    <label for="rangeMin">Valeur minimale (vide = aucune)</label>
                    <div class="input-wrapper">
                        <i class="fas fa-angle-double-down"></i>
                        <input type="number" id="rangeMin" min="1" step="0.01" placeholder="ex: 1.5">
                    </div>
                </div>
                <div class="form-group">
                    <label for="rangeMax">Valeur maximale (vide = aucune)</label>
                    <div class="input-wrapper">
                        <i class="fas fa-angle-double-up"></i>
                        <input type="number" id="rangeMax" min="1" step="0.01" placeholder="ex: 2.0">
                    </div>
                </div>
                <div class="form-group">
                    <label for="rangeColor">Couleur</label>
                    <div class="color-picker-wrapper">
                        <input type="color" id="rangeColor" value="#3498db">
                        <span class="color-preview" id="colorPreview" style="background-color: #3498db;"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="rangeSize">Taille d'analyse personnalis√©e</label>
                    <div class="input-wrapper">
                        <i class="fas fa-sort-numeric-down"></i>
                        <input type="number" id="rangeSize" min="5" max="10000" placeholder="ex: 1000 (vide = historique global)">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveRangeBtn" class="btn primary-btn full-width"><i class="fas fa-save"></i> Enregistrer</button>
            </div>
        </div>
    </div>

    <!-- Modal de pari rapide -->
    <div id="quickBetModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-bolt"></i> Pari rapide</h3>
                <button class="close quick-bet-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="quickBetAmount">Montant</label>
                    <div class="input-wrapper">
                        <i class="fas fa-coins"></i>
                        <input type="number" id="quickBetAmount" min="1" value="100" step="1">
                    </div>
                </div>
                <div class="form-group">
                    <label for="quickAutoCashout">Auto Cashout</label>
                    <div class="input-wrapper">
                        <i class="fas fa-rocket"></i>
                        <input type="number" id="quickAutoCashout" min="1.01" step="0.01" value="2.00">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="quickPlaceBetBtn" class="btn secondary-btn full-width"><i class="fas fa-play"></i> Placer le pari</button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="serverNotification" class="notification">
        Notification
    </div>

    <script src="https://cdn.jsdelivr.net/npm/socket.io@4.7.5/client-dist/socket.io.min.js"></script>
    <script>
        // Variables globales
        let audioContext = null;
        let socket;
        let isConnected = false;
        let crashHistory = [];
        let ranges = [];
        let editingRangeIndex = -1;
        let currentRanges = [];
        
        // Variables de pagination
        let currentPage = 1;
        let itemsPerPage = 50;
        let totalPages = 1;

        // Variables de connexion
        let connectionAttempts = 0;
        let maxConnectionAttempts = 100;
        let reconnectTimeout = null;

        // Variables utilisateur et coefficient
        let userInfo = {
            userName: "Utilisateur"
        };
        let currentCoefficient = null;

        // Variables syst√®me de d√©placement pour le coefficient
        let isDragging = false;
        let dragOffset = { x: 0, y: 0 };

        // Variables pour le graphique
        let rangeChart = null;
        let selectedRangeName = null;
        let rangeData = {};

        // Variables pour les notifications sonores
        let soundEnabled = true;
        let soundVolume = 0.5;
        let notificationAudio = null;

        // üîç VARIABLES POUR L'ANALYSE DES PICS ET CREUX
        let picsCreuxData = {};
        let globalTrendSummary = {};

        // üî• VARIABLES POUR L'ANALYSE DES CHUTES ET MONT√âES
        let chutesMonteeData = {};
        let globalChuteMonteeSummary = {};

        // üÜï NOUVELLES VARIABLES POUR L'ANALYSE DES PICS ET CREUX L√âGERS
        let picsCreuxLegersData = {};
        let globalPicsCreuxLegersSummary = {};

        // üî• NOUVELLES VARIABLES POUR L'ANALYSE DES PLATEAUX
        let plateauxData = {};
        let globalPlateauxSummary = {};

        // üå°Ô∏è NOUVELLES VARIABLES POUR LE THERMOM√àTRE DE SITUATION
        let thermometreData = {};
        let globalThermometreSummary = {};

        // üìä NOUVELLES VARIABLES POUR LE CLASSEMENT DES POURCENTAGES
        let percentageRankingData = {};
        let currentRangeClassement = null;

        // üéØ NOUVELLES VARIABLES POUR LES PR√âDICTIONS IA
        let currentPredictions = {};
        let predictionHistory = [];
        let modelMetrics = {};

        // Variables pour la mise √† jour automatique fluide
        let autoUpdateElements = [];

        // Initialiser le contexte audio et cr√©er la notification sonore
        function initAudioSystem() {
            try {
                // Cr√©er un son de notification agr√©able avec Web Audio API
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                // Cr√©er un son simple pour les notifications
                createNotificationSound();
                
                console.log('üîä Syst√®me audio initialis√©');
            } catch (error) {
                console.warn('‚ö†Ô∏è Impossible d\'initialiser l\'audio:', error);
            }
        }

        function createNotificationSound() {
            if (!audioContext) return;
            
            // Cr√©er un son de notification agr√©able (bip harmonique)
            const createBeep = (frequency, duration, volume) => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            };
            
            notificationAudio = () => {
                if (!soundEnabled || !audioContext) return;
                
                const volume = soundVolume * 0.1; // Limiter le volume max
                
                // Son de notification agr√©able (accord harmonique)
                createBeep(800, 0.15, volume);
                setTimeout(() => createBeep(1000, 0.15, volume), 100);
                setTimeout(() => createBeep(1200, 0.2, volume), 200);
            };
        }

        function playNotificationSound() {
            if (soundEnabled && notificationAudio) {
                try {
                    notificationAudio();
                } catch (error) {
                    console.warn('‚ö†Ô∏è Erreur lors de la lecture du son:', error);
                }
            }
        }

        function updateSoundSettings() {
            soundEnabled = document.getElementById('soundNotifications').checked;
            soundVolume = document.getElementById('soundVolume').value / 100;
            
            // Sauvegarder les pr√©f√©rences
            localStorage.setItem('soundEnabled', soundEnabled);
            localStorage.setItem('soundVolume', soundVolume);
            
            // Mettre √† jour l'affichage du volume
            document.getElementById('volumeDisplay').textContent = Math.round(soundVolume * 100) + '%';
            
            // Test sonore si activ√©
            if (soundEnabled) {
                playNotificationSound();
                afficherNotification("üîä Notifications sonores activ√©es", "#2ecc71");
            } else {
                afficherNotification("üîá Notifications sonores d√©sactiv√©es", "#f39c12");
            }
        }

        function loadSoundSettings() {
            const savedSoundEnabled = localStorage.getItem('soundEnabled');
            const savedSoundVolume = localStorage.getItem('soundVolume');
            
            if (savedSoundEnabled !== null) {
                soundEnabled = savedSoundEnabled === 'true';
                document.getElementById('soundNotifications').checked = soundEnabled;
            }
            
            if (savedSoundVolume !== null) {
                soundVolume = parseFloat(savedSoundVolume);
                document.getElementById('soundVolume').value = soundVolume * 100;
                document.getElementById('volumeDisplay').textContent = Math.round(soundVolume * 100) + '%';
            }
        }

        // üéØ NOUVELLES FONCTIONS POUR LES PR√âDICTIONS IA

        /**
         * Affiche la recommandation principale IA
         */
        function displayMainRecommendation(prediction) {
            const mainRecommendationCard = document.getElementById('mainRecommendationCard');
            
            if (!prediction || !prediction.recommendation) {
                mainRecommendationCard.innerHTML = `
                    <div class="recommendation-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="recommendation-content">
                        <div class="recommendation-title">Aucune pr√©diction disponible</div>
                        <div class="recommendation-subtitle">Donn√©es insuffisantes</div>
                        <div class="recommendation-action">Veuillez attendre plus de donn√©es</div>
                    </div>
                    <div class="probability-badge">
                        --%
                    </div>
                `;
                return;
            }
            
            const rec = prediction.recommendation;
            const iconClass = rec.riskLevel === "faible" ? "fa-thumbs-up" : 
                             rec.riskLevel === "moyen" ? "fa-exclamation" : "fa-exclamation-triangle";
            
            const badgeColor = rec.probability > 70 ? "#2ecc71" : 
                              rec.probability > 50 ? "#f39c12" : "#e74c3c";
            
            mainRecommendationCard.innerHTML = `
                <div class="recommendation-icon">
                    <i class="fas ${iconClass}"></i>
                </div>
                <div class="recommendation-content">
                    <div class="recommendation-title">${rec.mostLikely}</div>
                    <div class="recommendation-subtitle">Risque: ${rec.riskLevel.toUpperCase()}</div>
                    <div class="recommendation-action">${rec.action}</div>
                </div>
                <div class="probability-badge" style="background-color: ${badgeColor};">
                    ${rec.probability}%
                </div>
            `;
        }

        /**
         * Affiche les pr√©dictions d√©taill√©es par range
         */
        function displayDetailedPredictions(predictions) {
            const predictionsList = document.getElementById('predictionsList');
            
            if (!predictions || predictions.length === 0) {
                predictionsList.innerHTML = '<div class="no-events-message">Aucune pr√©diction disponible</div>';
                return;
            }
            
            predictionsList.innerHTML = predictions.map(pred => {
                const confidenceClass = pred.confidence === "√©lev√©e" ? "success" : 
                                       pred.confidence === "moyenne" ? "warning" : "danger";
                
                const borderColor = pred.probability > 70 ? "#2ecc71" : 
                                   pred.probability > 50 ? "#f39c12" : "#e74c3c";
                
                return `
                    <div class="prediction-card" style="border-left-color: ${borderColor};">
                        <div class="prediction-header">
                            <div class="prediction-range-name">${pred.rangeName}</div>
                            <div class="prediction-probability">${pred.probability}%</div>
                        </div>
                        <div class="prediction-confidence">
                            Confiance: <span class="trend-badge ${confidenceClass}">${pred.confidence}</span>
                            | Fiabilit√©: ${(pred.modelReliability * 100).toFixed(0)}%
                        </div>
                        <div class="prediction-reasoning">
                            <strong>Raisons:</strong>
                            <ul>
                                ${pred.reasoning.map(reason => `<li>${reason}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            }).join('');
        }

        /**
         * Affiche les m√©triques du mod√®le IA
         */
        function displayModelMetrics(metrics) {
            const modelMetricsGrid = document.getElementById('modelMetricsGrid');
            
            if (!metrics) {
                modelMetricsGrid.innerHTML = '<div class="no-events-message">Aucune m√©trique disponible</div>';
                return;
            }
            
            modelMetricsGrid.innerHTML = `
                <div class="model-metric-card">
                    <div class="model-metric-title">Certitude Totale</div>
                    <div class="model-metric-value">${metrics.totalCertainty}%</div>
                </div>
                <div class="model-metric-card">
                    <div class="model-metric-title">Index Dominance</div>
                    <div class="model-metric-value">${metrics.dominanceIndex}</div>
                </div>
                <div class="model-metric-card">
                    <div class="model-metric-title">Incertitude</div>
                    <div class="model-metric-value">${metrics.uncertainty}%</div>
                </div>
                <div class="model-metric-card">
                    <div class="model-metric-title">Fiabilit√© Mod√®le</div>
                    <div class="model-metric-value" style="text-transform: capitalize;">${metrics.modelReliability}</div>
                </div>
                <div class="model-metric-card">
                    <div class="model-metric-title">Fiabilit√© Moyenne</div>
                    <div class="model-metric-value">${(metrics.averageReliability * 100).toFixed(0)}%</div>
                </div>
            `;
        }

        /**
         * Traite les nouvelles pr√©dictions re√ßues du serveur
         */
        function processPredictionData(predictionData) {
            currentPredictions = predictionData || {};
            
            // Afficher la recommandation principale
            displayMainRecommendation(currentPredictions);
            
            // Afficher les pr√©dictions d√©taill√©es
            if (currentPredictions.predictions) {
                displayDetailedPredictions(currentPredictions.predictions);
            }
            
            // Afficher les m√©triques du mod√®le
            if (currentPredictions.predictionMetrics) {
                displayModelMetrics(currentPredictions.predictionMetrics);
            }
            
            // Afficher la section des pr√©dictions
            document.getElementById('predictionSection').style.display = 'block';
            
            console.log('üéØ Pr√©dictions IA mises √† jour:', currentPredictions);
        }

        /**
         * Actualise les pr√©dictions
         */
        function refreshPredictions() {
            if (!isConnected) {
                afficherNotification("‚ùå Non connect√© au serveur", "#e74c3c");
                return;
            }
            
            socket.emit('message', { type: 'getCrashPrediction' });
            afficherNotification("üîÑ Actualisation des pr√©dictions IA...", "#3498db");
        }

        /**
         * Affiche l'analyse des transitions (fonction placeholder)
         */
        function viewTransitionAnalysis() {
            if (!selectedRangeName) {
                afficherNotification("‚ùå Veuillez d'abord s√©lectionner une range", "#e74c3c");
                return;
            }
            
            if (!isConnected) {
                afficherNotification("‚ùå Non connect√© au serveur", "#e74c3c");
                return;
            }
            
            socket.emit('message', { 
                type: 'getRankingEvolution',
                rangeName: selectedRangeName 
            });
            
            afficherNotification("üîÑ Chargement de l'analyse des transitions...", "#3498db");
        }

        /**
         * Affiche l'analyse du momentum (fonction placeholder)
         */
        function viewMomentumAnalysis() {
            if (!selectedRangeName) {
                afficherNotification("‚ùå Veuillez d'abord s√©lectionner une range", "#e74c3c");
                return;
            }
            
            afficherNotification("üöÄ Analyse de momentum pour " + selectedRangeName, "#3498db");
            // Ici on pourrait ouvrir une modal avec les d√©tails du momentum
        }

        /**
         * Efface l'historique pr√©dictif
         */
        function clearPredictionHistory() {
            if (!isConnected) {
                afficherNotification("‚ùå Non connect√© au serveur", "#e74c3c");
                return;
            }
            
            showConfirmDialog("Voulez-vous vraiment effacer tout l'historique pr√©dictif?\nCette action r√©initialisera tous les mod√®les IA.", () => {
                socket.emit('message', { type: 'clearPredictionHistory' });
                afficherNotification("üîÑ Effacement de l'historique pr√©dictif...", "#3498db");
            });
        }

        // D√©marrer automatiquement l'actualisation des pr√©dictions
        refreshPredictions();
        setInterval(refreshPredictions, 5000); // Actualiser toutes les 5 secondes

        // üìä NOUVELLES FONCTIONS POUR LE CLASSEMENT DES POURCENTAGES

        /**
         * Affiche les statistiques globales du classement des pourcentages
         */
        function displayClassementGlobalStats(globalRanking) {
            const classementGlobalStats = document.getElementById('classementGlobalStats');
            
            if (!globalRanking || globalRanking.totalRanges === 0) {
                classementGlobalStats.innerHTML = '<div class="no-events-message">Aucune donn√©e de classement disponible</div>';
                return;
            }
            
            classementGlobalStats.innerHTML = `
                <div class="classement-stat-card">
                    <div class="classement-stat-icon ranking"><i class="fas fa-ranking-star"></i></div>
                    <div class="classement-stat-title">Ranges Analys√©es</div>
                    <div class="classement-stat-value">${globalRanking.totalRanges}</div>
                    <div class="classement-stat-subtitle">avec classement</div>
                </div>
                
                <div class="classement-stat-card">
                    <div class="classement-stat-icon frequency"><i class="fas fa-chart-bar"></i></div>
                    <div class="classement-stat-title">Total Pourcentages</div>
                    <div class="classement-stat-value">${globalRanking.totalUniquePercentages}</div>
                    <div class="classement-stat-subtitle">Moy: ${globalRanking.averageUniquePercentages} par range</div>
                </div>
                
                <div class="classement-stat-card">
                    <div class="classement-stat-icon stability"><i class="fas fa-balance-scale"></i></div>
                    <div class="classement-stat-title">Stabilit√© Moyenne</div>
                    <div class="classement-stat-value">${globalRanking.averageStability}%</div>
                    <div class="classement-stat-subtitle">Index global</div>
                </div>
                
                <div class="classement-stat-card">
                    <div class="classement-stat-icon mode"><i class="fas fa-trophy"></i></div>
                    <div class="classement-stat-title">Tendance Fr√©quence</div>
                    <div class="classement-stat-value">
                        <span class="trend-badge ${globalRanking.globalTrendFrequency}">${globalRanking.globalTrendFrequency.replace('-', ' ').toUpperCase()}</span>
                    </div>
                    <div class="classement-stat-subtitle">Dominance: ${globalRanking.recommendationDominance.replace('-', ' ')}</div>
                </div>
            `;
            
            if (globalRanking.rangeMostStable) {
                classementGlobalStats.innerHTML += `
                    <div class="classement-stat-card">
                        <div class="classement-stat-icon stability"><i class="fas fa-medal"></i></div>
                        <div class="classement-stat-title">Range Plus Stable</div>
                        <div class="classement-stat-value">${globalRanking.rangeMostStable.name}</div>
                        <div class="classement-stat-subtitle">Stabilit√©: ${globalRanking.rangeMostStable.stability}%</div>
                    </div>
                `;
            }
            
            if (globalRanking.rangeMostDiverse) {
                classementGlobalStats.innerHTML += `
                    <div class="classement-stat-card">
                        <div class="classement-stat-icon frequency"><i class="fas fa-star"></i></div>
                        <div class="classement-stat-title">Range Plus Diverse</div>
                        <div class="classement-stat-value">${globalRanking.rangeMostDiverse.name}</div>
                        <div class="classement-stat-subtitle">${globalRanking.rangeMostDiverse.uniquePercentages} pourcentages</div>
                    </div>
                `;
            }
        }

        /**
         * Affiche le top des pourcentages pour une range
         */
        function displayTopPercentages(topPercentages, rangeName = null) {
            const topPercentagesList = document.getElementById('topPercentagesList');
            
            if (!topPercentages || topPercentages.length === 0) {
                topPercentagesList.innerHTML = '<div class="no-events-message">Aucun pourcentage trouv√©</div>';
                return;
            }
            
            const title = rangeName ? `Top pourcentages - ${rangeName}` : 'Top pourcentages globaux';
            document.querySelector('#topPercentages h5').innerHTML = `<i class="fas fa-medal"></i> ${title}`;
            
            topPercentagesList.innerHTML = topPercentages.map(item => `
                <div class="percentage-item">
                    <div class="percentage-info">
                        <div class="percentage-value">${item.percentage}%</div>
                        <div class="percentage-details">
                            Fr√©quence: ${item.frequency} fois (${item.occurrencePercentage}%)
                        </div>
                        <div class="percentage-details">
                            <span class="category-badge ${item.category.toLowerCase().replace(/[^a-z]/g, '-')}">${item.category}</span>
                        </div>
                    </div>
                    <div class="percentage-rank">#${item.rank}</div>
                </div>
            `).join('');
        }

        /**
         * Recherche un pourcentage sp√©cifique dans une range
         */
        function searchPercentageInRange() {
            if (!selectedRangeName) {
                afficherNotification("‚ùå Veuillez d'abord s√©lectionner une range", "#e74c3c");
                return;
            }
            
            const percentage = parseFloat(document.getElementById('searchPercentageInput').value);
            if (isNaN(percentage)) {
                afficherNotification("‚ùå Veuillez entrer un pourcentage valide", "#e74c3c");
                return;
            }
            
            if (!isConnected) {
                afficherNotification("‚ùå Non connect√© au serveur", "#e74c3c");
                return;
            }
            
            // Demander au serveur de rechercher ce pourcentage
            socket.emit('message', {
                type: 'searchPercentageInRange',
                rangeName: selectedRangeName,
                percentage: percentage,
                tolerance: 0.1
            });
        }

        /**
         * Affiche les r√©sultats de recherche
         */
        function displaySearchResults(searchData) {
            const searchResults = document.getElementById('searchResults');
            const searchResultsList = document.getElementById('searchResultsList');
            
            if (!searchData.matches || searchData.matches.length === 0) {
                searchResultsList.innerHTML = `
                    <div class="no-events-message">
                        Aucun r√©sultat pour ${searchData.searchedPercentage}% dans ${searchData.rangeName}
                    </div>
                `;
            } else {
                searchResultsList.innerHTML = searchData.matches.map(item => `
                    <div class="percentage-item">
                        <div class="percentage-info">
                            <div class="percentage-value">${item.percentage}%</div>
                            <div class="percentage-details">
                                Fr√©quence: ${item.frequency} fois (${item.occurrencePercentage}%)
                            </div>
                            <div class="percentage-details">
                                <span class="category-badge ${item.category.toLowerCase().replace(/[^a-z]/g, '-')}">${item.category}</span>
                                √âcart cons√©cutif max: ${item.consecutiveCount}
                            </div>
                        </div>
                        <div class="percentage-rank">#${item.rank}</div>
                    </div>
                `).join('');
            }
            
            searchResults.classList.add('show');
        }

        /**
         * Affiche le classement pour une range sp√©cifique
         */
        function displayClassementForRange(rangeName) {
            const classementSection = document.getElementById('classementSection');
            
            if (!rangeName || !percentageRankingData.globalRanking) {
                classementSection.style.display = 'block';
                return;
            }
            
            classementSection.style.display = 'block';
            currentRangeClassement = rangeName;
            
            // Afficher les statistiques globales
            displayClassementGlobalStats(percentageRankingData.globalRanking);
            
            // Demander les top pourcentages pour cette range
            if (isConnected) {
                socket.emit('message', {
                    type: 'getTopPercentagesForRange',
                    rangeName: rangeName,
                    limit: 10
                });
            }
        }

        /**
         * Actualise le classement des pourcentages
         */
        function refreshClassement() {
            if (!isConnected) {
                afficherNotification("‚ùå Non connect√© au serveur", "#e74c3c");
                return;
            }
        
            // Demander une mise √† jour du classement
            socket.emit('message', { type: 'getPercentageRanking' });
            
            if (selectedRangeName) {
                socket.emit('message', {
                    type: 'getPercentageRankingForRange',
                    rangeName: selectedRangeName
                });
            }
            
            afficherNotification("üîÑ Actualisation du classement...", "#3498db");
        }
setInterval(refreshClassement, 1000);
        // üîç FONCTIONS POUR L'AFFICHAGE DES PICS ET CREUX

        /**
         * Affiche le r√©sum√© global des tendances (mise √† jour pour inclure pics/creux, chutes/mont√©es, pics/creux l√©gers, plateaux, thermom√®tre et classement)
         */
        function displayGlobalTrendSummary(picsCreuxSummary, chuteMonteeSummary, picsCreuxLegersSummary, plateauxSummary, thermometreSummary, percentageRankingSummary) {
            const globalTrendPanel = document.getElementById('globalTrendPanel');
            const globalTrendDisplay = document.getElementById('globalTrendDisplay');
            
            if ((!picsCreuxSummary || picsCreuxSummary.totalRanges === 0) && 
                (!chuteMonteeSummary || chuteMonteeSummary.totalRanges === 0) &&
                (!picsCreuxLegersSummary || picsCreuxLegersSummary.totalRanges === 0) &&
                (!plateauxSummary || plateauxSummary.totalRanges === 0) &&
                (!thermometreSummary || thermometreSummary.totalRanges === 0) &&
                (!percentageRankingSummary || percentageRankingSummary.totalRanges === 0)) {
                globalTrendPanel.style.display = 'none';
                return;
            }
            
            globalTrendPanel.style.display = 'block';
            
            let content = '';
            
            // üå°Ô∏è Section Thermom√®tre (priorit√© haute)
            if (thermometreSummary && thermometreSummary.totalRanges > 0) {
                content += `
                    <div class="trend-stat-card">
                        <div class="trend-stat-icon thermometre"><i class="fas fa-thermometer-half"></i></div>
                        <div class="trend-stat-title">Tendance Globale</div>
                        <div class="trend-stat-value">
                            <span class="trend-badge ${thermometreSummary.tendanceGlobale}">${thermometreSummary.tendanceGlobale.toUpperCase()}</span>
                        </div>
                        <div class="trend-stat-subtitle">${thermometreSummary.equilibreGlobal.toFixed(1)}% d'√©quilibre</div>
                    </div>
                    
                    <div class="trend-stat-card">
                        <div class="trend-stat-icon zone-negative"><i class="fas fa-arrow-down"></i></div>
                        <div class="trend-stat-title">Zone N√©gative</div>
                        <div class="trend-stat-value">${thermometreSummary.zoneNegativeGlobale.toFixed(1)}%</div>
                        <div class="trend-stat-subtitle">${thermometreSummary.repartitionGlobale.chutesProgressives + thermometreSummary.repartitionGlobale.creux + thermometreSummary.repartitionGlobale.creuxLegers} points</div>
                    </div>
                    
                    <div class="trend-stat-card">
                        <div class="trend-stat-icon zone-positive"><i class="fas fa-arrow-up"></i></div>
                        <div class="trend-stat-title">Zone Positive</div>
                        <div class="trend-stat-value">${thermometreSummary.zonePositiveGlobale.toFixed(1)}%</div>
                        <div class="trend-stat-subtitle">${thermometreSummary.repartitionGlobale.monteesProgressives + thermometreSummary.repartitionGlobale.pics + thermometreSummary.repartitionGlobale.picsLegers} points</div>
                    </div>
                `;
            }

            // üìä Section Classement des Pourcentages (nouvelle priorit√©)
            if (percentageRankingSummary && percentageRankingSummary.totalRanges > 0) {
                content += `
                    <div class="trend-stat-card">
                        <div class="trend-stat-icon ranking"><i class="fas fa-ranking-star"></i></div>
                        <div class="trend-stat-title">Classement Global</div>
                        <div class="trend-stat-value">
                            <span class="trend-badge ${percentageRankingSummary.globalTrendFrequency}">${percentageRankingSummary.globalTrendFrequency.replace('-', ' ').toUpperCase()}</span>
                        </div>
                        <div class="trend-stat-subtitle">${percentageRankingSummary.totalUniquePercentages} pourcentages uniques</div>
                    </div>
                    
                    <div class="trend-stat-card">
                        <div class="trend-stat-icon stability"><i class="fas fa-balance-scale"></i></div>
                        <div class="trend-stat-title">Stabilit√© Moyenne</div>
                        <div class="trend-stat-value">${percentageRankingSummary.averageStability}%</div>
                        <div class="trend-stat-subtitle">Index de stabilit√©</div>
                    </div>
                `;

                if (percentageRankingSummary.rangeMostStable) {
                    content += `
                        <div class="trend-stat-card">
                            <div class="trend-stat-icon mode"><i class="fas fa-medal"></i></div>
                            <div class="trend-stat-title">Range Plus Stable</div>
                            <div class="trend-stat-value">${percentageRankingSummary.rangeMostStable.name}</div>
                            <div class="trend-stat-subtitle">Stabilit√©: ${percentageRankingSummary.rangeMostStable.stability}%</div>
                        </div>
                    `;
                }
            }
            
            // Section Pics et Creux
            if (picsCreuxSummary && picsCreuxSummary.totalRanges > 0) {
                const repartitionPics = picsCreuxSummary.repartitionTendances || {};
                
                content += `
                    <div class="trend-stat-card">
                        <div class="trend-stat-icon tendance"><i class="fas fa-mountain"></i></div>
                        <div class="trend-stat-title">Tendance Pics/Creux</div>
                        <div class="trend-stat-value">
                            <span class="trend-badge ${picsCreuxSummary.tendanceGlobale}">${picsCreuxSummary.tendanceGlobale.toUpperCase()}</span>
                        </div>
                        <div class="trend-stat-subtitle">${picsCreuxSummary.totalEvents} √©v√©nements</div>
                    </div>
                    
                    <div class="trend-stat-card">
                        <div class="trend-stat-icon variabilite"><i class="fas fa-chart-area"></i></div>
                        <div class="trend-stat-title">Variabilit√© Pics/Creux</div>
                        <div class="trend-stat-value">${picsCreuxSummary.moyenneVariabilite.toFixed(2)}%</div>
                        <div class="trend-stat-subtitle">P:${repartitionPics.piquante || 0} | C:${repartitionPics.creusante || 0}</div>
                    </div>
                `;
            }
            
            // Section Chutes et Mont√©es
            if (chuteMonteeSummary && chuteMonteeSummary.totalRanges > 0) {
                content += `
                    <div class="trend-stat-card">
                        <div class="trend-stat-icon tendance"><i class="fas fa-chart-area"></i></div>
                        <div class="trend-stat-title">Tendance Chutes/Mont√©es</div>
                        <div class="trend-stat-value">
                            <span class="trend-badge ${chuteMonteeSummary.tendanceGlobale}">${chuteMonteeSummary.tendanceGlobale.toUpperCase()}</span>
                        </div>
                        <div class="trend-stat-subtitle">${chuteMonteeSummary.totalEvents} mouvements</div>
                    </div>
                    
                    <div class="trend-stat-card">
                        <div class="trend-stat-icon variabilite"><i class="fas fa-stopwatch"></i></div>
                        <div class="trend-stat-title">Dur√©e Moy. Mouvements</div>
                        <div class="trend-stat-value">${chuteMonteeSummary.moyenneDureeMovement.toFixed(1)}</div>
                        <div class="trend-stat-subtitle">Ch:${chuteMonteeSummary.totalChutes} | Mo:${chuteMonteeSummary.totalMontees}</div>
                    </div>
                `;
            }

            // üÜï Section Pics et Creux L√©gers
            if (picsCreuxLegersSummary && picsCreuxLegersSummary.totalRanges > 0) {
                const repartitionLegers = picsCreuxLegersSummary.repartitionTendances || {};
                
                content += `
                    <div class="trend-stat-card">
                        <div class="trend-stat-icon tendance"><i class="fas fa-wave-square"></i></div>
                        <div class="trend-stat-title">Tendance Pics/Creux L√©gers</div>
                        <div class="trend-stat-value">
                            <span class="trend-badge ${picsCreuxLegersSummary.tendanceGlobale}">${picsCreuxLegersSummary.tendanceGlobale.toUpperCase()}</span>
                        </div>
                        <div class="trend-stat-subtitle">${picsCreuxLegersSummary.totalEvents} √©v√©nements</div>
                    </div>
                    
                    <div class="trend-stat-card">
                        <div class="trend-stat-icon stabilite"><i class="fas fa-balance-scale"></i></div>
                        <div class="trend-stat-title">Stabilit√© Moyenne</div>
                        <div class="trend-stat-value">${picsCreuxLegersSummary.moyenneStabilite.toFixed(2)}%</div>
                        <div class="trend-stat-subtitle">PL:${picsCreuxLegersSummary.totalPicsLegers} | CL:${picsCreuxLegersSummary.totalCreuxLegers}</div>
                    </div>
                `;
            }

            // üî• Section Plateaux
            if (plateauxSummary && plateauxSummary.totalRanges > 0) {
                content += `
                    <div class="trend-stat-card">
                        <div class="trend-stat-icon plateau-stable"><i class="fas fa-chart-line"></i></div>
                        <div class="trend-stat-title">Tendance Plateaux</div>
                        <div class="trend-stat-value">
                            <span class="trend-badge ${plateauxSummary.tendanceGlobaleGenerale}">${plateauxSummary.tendanceGlobaleGenerale.toUpperCase()}</span>
                        </div>
                        <div class="trend-stat-subtitle">${plateauxSummary.totalPlateaux} plateaux</div>
                    </div>
                    
                    <div class="trend-stat-card">
                        <div class="trend-stat-icon plateau-activite"><i class="fas fa-layer-group"></i></div>
                        <div class="trend-stat-title">Activit√© Dominante</div>
                        <div class="trend-stat-value">
                            <span class="trend-badge ${plateauxSummary.typeActiviteDominanteGlobale}">${plateauxSummary.typeActiviteDominanteGlobale.replace('-', ' ').toUpperCase()}</span>
                        </div>
                        <div class="trend-stat-subtitle">${plateauxSummary.pourcentageTempsEnPlateauGlobal.toFixed(1)}% en plateau</div>
                    </div>
                `;
            }
            
            // Range la plus active ou la plus n√©gative/positive (priorit√© mise √† jour)
            let mostActiveRange = null;
            if (percentageRankingSummary && percentageRankingSummary.rangeMostDiverse) {
                mostActiveRange = {
                    name: percentageRankingSummary.rangeMostDiverse.name,
                    events: percentageRankingSummary.rangeMostDiverse.uniquePercentages + ' %',
                    type: "pourcentages",
                    icon: "fas fa-star"
                };
            } else if (thermometreSummary && thermometreSummary.rangeMostNegative) {
                mostActiveRange = {
                    name: thermometreSummary.rangeMostNegative.name,
                    events: thermometreSummary.rangeMostNegative.pourcentage.toFixed(1) + '%',
                    type: "n√©gative",
                    icon: "fas fa-thermometer-quarter"
                };
            } else if (thermometreSummary && thermometreSummary.rangeMostPositive) {
                mostActiveRange = {
                    name: thermometreSummary.rangeMostPositive.name,
                    events: thermometreSummary.rangeMostPositive.pourcentage.toFixed(1) + '%',
                    type: "positive",
                    icon: "fas fa-thermometer-three-quarters"
                };
            } else if (picsCreuxSummary && picsCreuxSummary.rangeMostActive) {
                mostActiveRange = {
                    name: picsCreuxSummary.rangeMostActive.name,
                    events: picsCreuxSummary.rangeMostActive.events,
                    type: "pics/creux",
                    icon: "fas fa-trophy"
                };
            } else if (chuteMonteeSummary && chuteMonteeSummary.rangeMostActive) {
                mostActiveRange = {
                    name: chuteMonteeSummary.rangeMostActive.name,
                    events: chuteMonteeSummary.rangeMostActive.events,
                    type: "mouvements",
                    icon: "fas fa-trophy"
                };
            } else if (picsCreuxLegersSummary && picsCreuxLegersSummary.rangeMostActive) {
                mostActiveRange = {
                    name: picsCreuxLegersSummary.rangeMostActive.name,
                    events: picsCreuxLegersSummary.rangeMostActive.events,
                    type: "l√©gers",
                    icon: "fas fa-trophy"
                };
            } else if (plateauxSummary && plateauxSummary.rangeMostStable) {
                mostActiveRange = {
                    name: plateauxSummary.rangeMostStable.name,
                    events: plateauxSummary.rangeMostStable.stabilite,
                    type: "stable",
                    icon: "fas fa-medal"
                };
            }

            if (mostActiveRange) {
                content += `
                    <div class="trend-stat-card">
                        <div class="trend-stat-icon pic"><i class="${mostActiveRange.icon}"></i></div>
                        <div class="trend-stat-title">Range Plus Active</div>
                        <div class="trend-stat-value">${mostActiveRange.name}</div>
                        <div class="trend-stat-subtitle">${mostActiveRange.events} ${mostActiveRange.type}</div>
                    </div>
                `;
            }
            
            globalTrendDisplay.innerHTML = content;
        }

        /**
         * Affiche l'analyse des pics et creux pour une range sp√©cifique
         */
        function displayPicsCreuxForRange(rangeName, rangeAnalysis) {
            const picsCreuxSection = document.getElementById('picsCreuxSection');
            const trendGlobalStats = document.getElementById('trendGlobalStats');
            const eventsList = document.getElementById('eventsList');
            
            if (!rangeAnalysis || !rangeAnalysis.events) {
                picsCreuxSection.style.display = 'none';
                return;
            }
            
            picsCreuxSection.style.display = 'block';
            
            const globalTrend = rangeAnalysis.globalTrend;
            const events = rangeAnalysis.events || [];
            
            // Afficher les statistiques globales de la tendance
            trendGlobalStats.innerHTML = `
                <div class="trend-stat-card">
                    <div class="trend-stat-icon pic"><i class="fas fa-mountain"></i></div>
                    <div class="trend-stat-title">Pics D√©tect√©s</div>
                    <div class="trend-stat-value">${globalTrend.totalPics}</div>
                    <div class="trend-stat-subtitle">Hauteur moy: ${globalTrend.moyenneHauteurPics.toFixed(2)}%</div>
                </div>
                
                <div class="trend-stat-card">
                    <div class="trend-stat-icon creux"><i class="fas fa-valley"></i></div>
                    <div class="trend-stat-title">Creux D√©tect√©s</div>
                    <div class="trend-stat-value">${globalTrend.totalCreux}</div>
                    <div class="trend-stat-subtitle">Profondeur moy: ${globalTrend.moyenneProfondeurCreux.toFixed(2)}%</div>
                </div>
                
                <div class="trend-stat-card">
                    <div class="trend-stat-icon tendance"><i class="fas fa-chart-line"></i></div>
                    <div class="trend-stat-title">Tendance</div>
                    <div class="trend-stat-value">
                        <span class="trend-badge ${globalTrend.tendance}">${globalTrend.tendance.toUpperCase()}</span>
                    </div>
                    <div class="trend-stat-subtitle">${globalTrend.intensiteGlobale}</div>
                </div>
                
                <div class="trend-stat-card">
                    <div class="trend-stat-icon variabilite"><i class="fas fa-chart-area"></i></div>
                    <div class="trend-stat-title">Variabilit√©</div>
                    <div class="trend-stat-value">${globalTrend.variabiliteGlobale.toFixed(2)}%</div>
                    <div class="trend-stat-subtitle">Ratio: ${globalTrend.ratioPicsCreux.toFixed(2)}</div>
                </div>
            `;
            
            // Afficher les derniers √©v√©nements (max 10)
            const recentEvents = events.slice(-10).reverse();
            
            if (recentEvents.length === 0) {
                eventsList.innerHTML = '<div class="no-events-message">Aucun √©v√©nement d√©tect√© r√©cemment</div>';
            } else {
                eventsList.innerHTML = recentEvents.map(event => `
                    <div class="event-badge ${event.type}">
                        <i class="fas fa-${event.type === 'pic' ? 'arrow-up' : 'arrow-down'}"></i>
                        <div class="event-details">
                            <span class="event-value">${event.value.toFixed(2)}%</span>
                            <span class="event-intensity">Int: ${event.profondeur.toFixed(1)}%</span>
                        </div>
                    </div>
                `).join('');
            }
        }

        // üî• FONCTIONS POUR L'AFFICHAGE DES CHUTES ET MONT√âES

        /**
         * Affiche l'analyse des chutes et mont√©es pour une range sp√©cifique
         */
        function displayChutesMonteeForRange(rangeName, rangeAnalysis) {
            const chutesMonteeSection = document.getElementById('chutesMonteeSection');
            const movementGlobalStats = document.getElementById('movementGlobalStats');
            const movementsList = document.getElementById('movementsList');
            
            if (!rangeAnalysis || !rangeAnalysis.events) {
                chutesMonteeSection.style.display = 'none';
                return;
            }
            
            chutesMonteeSection.style.display = 'block';
            
            const globalTrend = rangeAnalysis.globalTrend;
            const events = rangeAnalysis.events || [];
            
            // Afficher les statistiques globales des mouvements
            movementGlobalStats.innerHTML = `
                <div class="trend-stat-card">
                    <div class="trend-stat-icon chute"><i class="fas fa-arrow-trend-down"></i></div>
                    <div class="trend-stat-title">Chutes D√©tect√©es</div>
                    <div class="trend-stat-value">${globalTrend.totalChutes}</div>
                    <div class="trend-stat-subtitle">Longueur moy: ${globalTrend.moyenneLongueurChutes.toFixed(1)} pts</div>
                </div>
                
                <div class="trend-stat-card">
                    <div class="trend-stat-icon montee"><i class="fas fa-arrow-trend-up"></i></div>
                    <div class="trend-stat-title">Mont√©es D√©tect√©es</div>
                    <div class="trend-stat-value">${globalTrend.totalMontees}</div>
                    <div class="trend-stat-subtitle">Longueur moy: ${globalTrend.moyenneLongueurMontees.toFixed(1)} pts</div>
                </div>
                
                <div class="trend-stat-card">
                    <div class="trend-stat-icon tendance"><i class="fas fa-chart-line"></i></div>
                    <div class="trend-stat-title">Tendance</div>
                    <div class="trend-stat-value">
                        <span class="trend-badge ${globalTrend.tendanceGlobale}">${globalTrend.tendanceGlobale.toUpperCase()}</span>
                    </div>
                    <div class="trend-stat-subtitle">${globalTrend.pourcentageChutes.toFixed(1)}% vs ${globalTrend.pourcentageMontees.toFixed(1)}%</div>
                </div>
                
                <div class="trend-stat-card">
                    <div class="trend-stat-icon variabilite"><i class="fas fa-stopwatch"></i></div>
                    <div class="trend-stat-title">Dur√©e Moyenne</div>
                    <div class="trend-stat-value">${globalTrend.dureeMovementMoyenne.toFixed(1)}</div>
                    <div class="trend-stat-subtitle">Ratio: ${globalTrend.ratioChutesVsMontees.toFixed(2)}</div>
                </div>
            `;
            
            // Afficher les derniers mouvements (max 10)
            const recentMovements = events.slice(-10).reverse();
            
            if (recentMovements.length === 0) {
                movementsList.innerHTML = '<div class="no-events-message">Aucun mouvement d√©tect√© r√©cemment</div>';
            } else {
                movementsList.innerHTML = recentMovements.map(movement => `
                    <div class="movement-badge ${movement.type}">
                        <i class="fas fa-${movement.type === 'chute' ? 'arrow-down' : 'arrow-up'}"></i>
                        <div class="movement-details">
                            <span class="movement-variation">${movement.type === 'montee' ? '+' : ''}${Math.abs(movement.variation).toFixed(2)}%</span>
                            <span class="movement-length">Long: ${movement.length} pts | R√©g: ${movement.regularity.toFixed(0)}%</span>
                        </div>
                    </div>
                `).join('');
            }
        }

        // üÜï NOUVELLES FONCTIONS POUR L'AFFICHAGE DES PICS ET CREUX L√âGERS

        /**
         * Affiche l'analyse des pics et creux l√©gers pour une range sp√©cifique
         */
        function displayPicsCreuxLegersForRange(rangeName, rangeAnalysis) {
            const picsCreuxLegersSection = document.getElementById('picsCreuxLegersSection');
            const lightTrendGlobalStats = document.getElementById('lightTrendGlobalStats');
            const lightEventsList = document.getElementById('lightEventsList');
            
            if (!rangeAnalysis || !rangeAnalysis.events) {
                picsCreuxLegersSection.style.display = 'none';
                return;
            }
            
            picsCreuxLegersSection.style.display = 'block';
            
            const globalTrend = rangeAnalysis.globalTrend;
            const events = rangeAnalysis.events || [];
            
            // Afficher les statistiques globales des pics et creux l√©gers
            lightTrendGlobalStats.innerHTML = `
                <div class="trend-stat-card">
                    <div class="trend-stat-icon pic-leger"><i class="fas fa-wave-square"></i></div>
                    <div class="trend-stat-title">Pics L√©gers</div>
                    <div class="trend-stat-value">${globalTrend.totalPicsLegers}</div>
                    <div class="trend-stat-subtitle">Plateau moy: ${globalTrend.moyennePlateauLengthPics.toFixed(1)} pts</div>
                </div>
                
                <div class="trend-stat-card">
                    <div class="trend-stat-icon creux-leger"><i class="fas fa-wave-square"></i></div>
                    <div class="trend-stat-title">Creux L√©gers</div>
                    <div class="trend-stat-value">${globalTrend.totalCreuxLegers}</div>
                    <div class="trend-stat-subtitle">Plateau moy: ${globalTrend.moyennePlateauLengthCreux.toFixed(1)} pts</div>
                </div>
                
                <div class="trend-stat-card">
                    <div class="trend-stat-icon tendance"><i class="fas fa-chart-line"></i></div>
                    <div class="trend-stat-title">Tendance</div>
                    <div class="trend-stat-value">
                        <span class="trend-badge ${globalTrend.tendance}">${globalTrend.tendance.toUpperCase()}</span>
                    </div>
                    <div class="trend-stat-subtitle">${globalTrend.pourcentagePicsLegers.toFixed(1)}% vs ${globalTrend.pourcentageCreuxLegers.toFixed(1)}%</div>
                </div>
                
                <div class="trend-stat-card">
                    <div class="trend-stat-icon stabilite"><i class="fas fa-balance-scale"></i></div>
                    <div class="trend-stat-title">Stabilit√© Globale</div>
                    <div class="trend-stat-value">${globalTrend.stabiliteGlobale.toFixed(2)}%</div>
                    <div class="trend-stat-subtitle">Dur√©e moy: ${globalTrend.moyenneDureePlateaux.toFixed(1)} pts</div>
                </div>
            `;
            
            // Afficher les derniers √©v√©nements l√©gers (max 10)
            const recentLightEvents = events.slice(-10).reverse();
            
            if (recentLightEvents.length === 0) {
                lightEventsList.innerHTML = '<div class="no-events-message">Aucun √©v√©nement l√©ger d√©tect√© r√©cemment</div>';
            } else {
                lightEventsList.innerHTML = recentLightEvents.map(event => `
                    <div class="event-badge ${event.type}">
                        <i class="fas fa-${event.type === 'pic-leger' ? 'angle-up' : 'angle-down'}"></i>
                        <div class="light-event-details">
                            <span class="event-value">${event.value.toFixed(2)}%</span>
                            <span class="plateau-length">Plateau: ${event.plateauLength} pts</span>
                            <span class="stability-info">Stab: ${event.stability.toFixed(1)}%</span>
                        </div>
                    </div>
                `).join('');
            }
        }

        // üî• NOUVELLES FONCTIONS POUR L'AFFICHAGE DES PLATEAUX

        /**
         * Affiche l'analyse des plateaux pour une range sp√©cifique
         */
        function displayPlateauxForRange(rangeName, rangeAnalysis) {
            const plateauxSection = document.getElementById('plateauxSection');
            const plateauxGlobalStats = document.getElementById('plateauxGlobalStats');
            const plateauxList = document.getElementById('plateauxList');
            
            if (!rangeAnalysis || !rangeAnalysis.plateaux) {
                plateauxSection.style.display = 'none';
                return;
            }
            
            plateauxSection.style.display = 'block';
            
            const globalTrend = rangeAnalysis.globalTrend;
            const plateaux = rangeAnalysis.plateaux || [];
            
            // Afficher les statistiques globales des plateaux
            plateauxGlobalStats.innerHTML = `
                <div class="trend-stat-card">
                    <div class="trend-stat-icon plateau-stable"><i class="fas fa-chart-line"></i></div>
                    <div class="trend-stat-title">Plateaux D√©tect√©s</div>
                    <div class="trend-stat-value">${globalTrend.totalPlateaux}</div>
                    <div class="trend-stat-subtitle">Longueur moy: ${globalTrend.moyenneLongueurPlateaux.toFixed(1)} pts</div>
                </div>
                
                <div class="trend-stat-card">
                    <div class="trend-stat-icon plateau-stabilite"><i class="fas fa-balance-scale"></i></div>
                    <div class="trend-stat-title">Stabilit√© Moyenne</div>
                    <div class="trend-stat-value">${globalTrend.moyenneStabilitePlateaux.toFixed(1)}%</div>
                    <div class="trend-stat-subtitle">Variation: ${globalTrend.moyenneVariationPlateaux.toFixed(2)}%</div>
                </div>
                
                <div class="trend-stat-card">
                    <div class="trend-stat-icon tendance"><i class="fas fa-chart-bar"></i></div>
                    <div class="trend-stat-title">Tendance Globale</div>
                    <div class="trend-stat-value">
                        <span class="trend-badge ${globalTrend.tendanceGlobale}">${globalTrend.tendanceGlobale.replace('-', ' ').toUpperCase()}</span>
                    </div>
                    <div class="trend-stat-subtitle">${globalTrend.pourcentageTempsEnPlateau.toFixed(1)}% en plateau</div>
                </div>
                
                <div class="trend-stat-card">
                    <div class="trend-stat-icon plateau-activite"><i class="fas fa-layer-group"></i></div>
                    <div class="trend-stat-title">Activit√© Dominante</div>
                    <div class="trend-stat-value">
                        <span class="trend-badge ${globalTrend.typeActiviteDominante}">${globalTrend.typeActiviteDominante.replace('-', ' ').toUpperCase()}</span>
                    </div>
                    <div class="trend-stat-subtitle">Ratio: ${globalTrend.ratioPlateauxVsEvenements.toFixed(2)}</div>
                </div>
            `;
            
            // Afficher les derniers plateaux (max 10)
            const recentPlateaux = plateaux.slice(-10).reverse();
            
            if (recentPlateaux.length === 0) {
                plateauxList.innerHTML = '<div class="no-events-message">Aucun plateau d√©tect√© r√©cemment</div>';
            } else {
                plateauxList.innerHTML = recentPlateaux.map(plateau => `
                    <div class="plateau-badge">
                        <i class="fas fa-minus"></i>
                        <div class="plateau-details">
                            <span class="event-value">${plateau.avgValue.toFixed(2)}%</span>
                            <span class="plateau-info">Long: ${plateau.length} pts | Stab: ${plateau.stability.toFixed(1)}%</span>
                            <span class="plateau-info">Tendance: ${plateau.internalTrend}</span>
                        </div>
                    </div>
                `).join('');
            }
        }

        // üå°Ô∏è NOUVELLES FONCTIONS POUR L'AFFICHAGE DU THERMOM√àTRE DE SITUATION

        /**
         * Affiche l'analyse du thermom√®tre de situation pour une range sp√©cifique
         */
        function displayThermometreForRange(rangeName, rangeAnalysis) {
            const thermometreSection = document.getElementById('thermometreSection');
            const thermometreGauge = document.getElementById('thermometreGauge');
            const thermometreZones = document.getElementById('thermometreZones');
            const repartitionGrid = document.getElementById('repartitionGrid');
            
            if (!rangeAnalysis || !rangeAnalysis.zoneData) {
                thermometreSection.style.display = 'none';
                return;
            }
            
            thermometreSection.style.display = 'block';
            
            const zoneData = rangeAnalysis.zoneData;
            
            // Calculer l'√©quilibre et la tendance
            const equilibre = zoneData.zonePositive - zoneData.zoneNegative;
            let tendance = "√âquilibr√©e";
            let gaugePosition = 50; // Position centrale par d√©faut
            
            if (Math.abs(equilibre) < 5) {
                tendance = "√âquilibr√©e";
                gaugePosition = 50;
            } else if (equilibre > 0) {
                if (equilibre > 20) {
                    tendance = "Tr√®s Positive";
                    gaugePosition = 80;
                } else {
                    tendance = "Positive";
                    gaugePosition = 65;
                }
            } else {
                if (equilibre < -20) {
                    tendance = "Tr√®s N√©gative";
                    gaugePosition = 20;
                } else {
                    tendance = "N√©gative";
                    gaugePosition = 35;
                }
            }
            
            // Mettre √† jour la jauge
            document.getElementById('equilibreValue').textContent = equilibre.toFixed(1) + '%';
            document.getElementById('tendanceThermometre').textContent = tendance;
            document.getElementById('gaugeIndicator').style.left = gaugePosition + '%';
            
            // Mettre √† jour les zones
            document.getElementById('zoneNegativeValue').textContent = zoneData.zoneNegative.toFixed(1) + '%';
            document.getElementById('zoneStabiliteValue').textContent = zoneData.zoneStabilite.toFixed(1) + '%';
            document.getElementById('zonePositiveValue').textContent = zoneData.zonePositive.toFixed(1) + '%';
            
            document.getElementById('zoneNegativeDetails').textContent = 
                `${zoneData.repartition.chutesProgressives + zoneData.repartition.creux + zoneData.repartition.creuxLegers} points n√©gatifs`;
            document.getElementById('zoneStabiliteDetails').textContent = 
                `${zoneData.repartition.stabilite} points de stabilit√©`;
            document.getElementById('zonePositiveDetails').textContent = 
                `${zoneData.repartition.monteesProgressives + zoneData.repartition.pics + zoneData.repartition.picsLegers} points positifs`;
            
            // Mettre √† jour la r√©partition d√©taill√©e
            repartitionGrid.innerHTML = `
                <div class="repartition-item">
                    <div class="repartition-icon pics"><i class="fas fa-mountain"></i></div>
                    <div class="repartition-label">Pics</div>
                    <div class="repartition-count">${zoneData.repartition.pics}</div>
                </div>
                <div class="repartition-item">
                    <div class="repartition-icon creux"><i class="fas fa-valley"></i></div>
                    <div class="repartition-label">Creux</div>
                    <div class="repartition-count">${zoneData.repartition.creux}</div>
                </div>
                <div class="repartition-item">
                    <div class="repartition-icon pics-legers"><i class="fas fa-angle-up"></i></div>
                    <div class="repartition-label">Pics L√©gers</div>
                    <div class="repartition-count">${zoneData.repartition.picsLegers}</div>
                </div>
                <div class="repartition-item">
                    <div class="repartition-icon creux-legers"><i class="fas fa-angle-down"></i></div>
                    <div class="repartition-label">Creux L√©gers</div>
                    <div class="repartition-count">${zoneData.repartition.creuxLegers}</div>
                </div>
                <div class="repartition-item">
                    <div class="repartition-icon montees"><i class="fas fa-arrow-up"></i></div>
                    <div class="repartition-label">Mont√©es</div>
                    <div class="repartition-count">${zoneData.repartition.monteesProgressives}</div>
                </div>
                <div class="repartition-item">
                    <div class="repartition-icon chutes"><i class="fas fa-arrow-down"></i></div>
                    <div class="repartition-label">Chutes</div>
                    <div class="repartition-count">${zoneData.repartition.chutesProgressives}</div>
                </div>
                <div class="repartition-item">
                    <div class="repartition-icon stabilite"><i class="fas fa-balance-scale"></i></div>
                    <div class="repartition-label">Stabilit√©</div>
                    <div class="repartition-count">${zoneData.repartition.stabilite}</div>
                </div>
            `;
        }

        /**
         * Traite les nouvelles donn√©es de pics et creux re√ßues du serveur
         */
        function processPicsCreuxData(analysisData, globalSummaryData) {
            picsCreuxData = analysisData || {};
            globalTrendSummary = globalSummaryData || {};
            
            // Si une range est s√©lectionn√©e, afficher son analyse
            if (selectedRangeName && picsCreuxData[selectedRangeName]) {
                displayPicsCreuxForRange(selectedRangeName, picsCreuxData[selectedRangeName]);
            }
            
            console.log('üîç Donn√©es pics/creux mises √† jour:', Object.keys(picsCreuxData).length, 'ranges');
        }

        // üî• FONCTIONS POUR TRAITER LES DONN√âES CHUTES/MONT√âES

        /**
         * Traite les nouvelles donn√©es de chutes et mont√©es re√ßues du serveur
         */
        function processChutesMonteeData(analysisData, globalSummaryData) {
            chutesMonteeData = analysisData || {};
            globalChuteMonteeSummary = globalSummaryData || {};
            
            // Si une range est s√©lectionn√©e, afficher son analyse
            if (selectedRangeName && chutesMonteeData[selectedRangeName]) {
                displayChutesMonteeForRange(selectedRangeName, chutesMonteeData[selectedRangeName]);
            }
            
            console.log('üî• Donn√©es chutes/mont√©es mises √† jour:', Object.keys(chutesMonteeData).length, 'ranges');
        }

        // üÜï NOUVELLES FONCTIONS POUR TRAITER LES DONN√âES PICS/CREUX L√âGERS

        /**
         * Traite les nouvelles donn√©es de pics et creux l√©gers re√ßues du serveur
         */
        function processPicsCreuxLegersData(analysisData, globalSummaryData) {
            picsCreuxLegersData = analysisData || {};
            globalPicsCreuxLegersSummary = globalSummaryData || {};
            
            // Si une range est s√©lectionn√©e, afficher son analyse
            if (selectedRangeName && picsCreuxLegersData[selectedRangeName]) {
                displayPicsCreuxLegersForRange(selectedRangeName, picsCreuxLegersData[selectedRangeName]);
            }
            
            console.log('üÜï Donn√©es pics/creux l√©gers mises √† jour:', Object.keys(picsCreuxLegersData).length, 'ranges');
        }

        // üî• NOUVELLES FONCTIONS POUR TRAITER LES DONN√âES PLATEAUX

        /**
         * Traite les nouvelles donn√©es de plateaux re√ßues du serveur
         */
        function processPlateauxData(analysisData, globalSummaryData) {
            plateauxData = analysisData || {};
            globalPlateauxSummary = globalSummaryData || {};
            
            // Si une range est s√©lectionn√©e, afficher son analyse
            if (selectedRangeName && plateauxData[selectedRangeName]) {
                displayPlateauxForRange(selectedRangeName, plateauxData[selectedRangeName]);
            }
            
            console.log('üî• Donn√©es plateaux mises √† jour:', Object.keys(plateauxData).length, 'ranges');
        }

        // üå°Ô∏è NOUVELLES FONCTIONS POUR TRAITER LES DONN√âES DU THERMOM√àTRE

        /**
         * Traite les nouvelles donn√©es du thermom√®tre de situation re√ßues du serveur
         */
        function processThermometreData(analysisData, globalSummaryData) {
            thermometreData = analysisData || {};
            globalThermometreSummary = globalSummaryData || {};
            
            // Si une range est s√©lectionn√©e, afficher son analyse
            if (selectedRangeName && thermometreData[selectedRangeName]) {
                displayThermometreForRange(selectedRangeName, thermometreData[selectedRangeName]);
            }
            
            console.log('üå°Ô∏è Donn√©es thermom√®tre mises √† jour:', Object.keys(thermometreData).length, 'ranges');
        }

        // üìä NOUVELLES FONCTIONS POUR TRAITER LES DONN√âES DE CLASSEMENT

        /**
         * Traite les nouvelles donn√©es de classement des pourcentages re√ßues du serveur
         */
        function processPercentageRankingData(rankingData) {
            percentageRankingData = rankingData || {};
            
            // Mettre √† jour le r√©sum√© global des tendances avec les donn√©es de classement
            displayGlobalTrendSummary(
                globalTrendSummary, 
                globalChuteMonteeSummary, 
                globalPicsCreuxLegersSummary, 
                globalPlateauxSummary, 
                globalThermometreSummary,
                percentageRankingData.globalRanking
            );
            
            // Si une range est s√©lectionn√©e, afficher son classement
            if (selectedRangeName) {
                displayClassementForRange(selectedRangeName);
            }
            
            console.log('üìä Donn√©es classement mises √† jour:', percentageRankingData.globalRanking ? percentageRankingData.globalRanking.totalRanges : 0, 'ranges');
        }

        // Fonction pour mettre √† jour l'affichage du coefficient
        function updateCoefficientDisplay(coefficient) {
            const coefficientDisplay = document.getElementById('coefficientDisplay');
            const coefficientValue = document.getElementById('coefficientValue');
            
            if (coefficient !== null && coefficient !== undefined) {
                coefficientValue.textContent = coefficient.toFixed(2) + 'x';
                coefficientDisplay.style.display = 'flex';
                
                // Ajouter une animation de pulsation pour indiquer la mise √† jour
                coefficientDisplay.classList.add('pulsing');
                setTimeout(() => {
                    coefficientDisplay.classList.remove('pulsing');
                }, 800);
            } else {
                coefficientDisplay.style.display = 'none';
            }
        }

        // Fonction pour animer la mise √† jour automatique fluide
        function animateAutoUpdate() {
            autoUpdateElements = document.querySelectorAll('.auto-update');
            autoUpdateElements.forEach(element => {
                element.classList.add('updating');
                setTimeout(() => {
                    element.classList.remove('updating');
                }, 300);
            });
        }

        // Fonctions de gestion du d√©placement du coefficient
        function initCoefficientDragging() {
            const coefficientDisplay = document.getElementById('coefficientDisplay');
            
            coefficientDisplay.addEventListener('mousedown', startDrag);
            coefficientDisplay.addEventListener('touchstart', startDrag);
            
            document.addEventListener('mousemove', drag);
            document.addEventListener('touchmove', drag);
            
            document.addEventListener('mouseup', stopDrag);
            document.addEventListener('touchend', stopDrag);
        }

        function startDrag(e) {
            e.preventDefault();
            isDragging = true;
            
            const coefficientDisplay = document.getElementById('coefficientDisplay');
            const rect = coefficientDisplay.getBoundingClientRect();
            
            const clientX = e.clientX || (e.touches && e.touches[0].clientX);
            const clientY = e.clientY || (e.touches && e.touches[0].clientY);
            
            dragOffset.x = clientX - rect.left;
            dragOffset.y = clientY - rect.top;
            
            coefficientDisplay.classList.add('dragging');
            coefficientDisplay.style.transition = 'none';
        }

        function drag(e) {
            if (!isDragging) return;
            
            e.preventDefault();
            const coefficientDisplay = document.getElementById('coefficientDisplay');
            
            const clientX = e.clientX || (e.touches && e.touches[0].clientX);
            const clientY = e.clientY || (e.touches && e.touches[0].clientY);
            
            let newX = clientX - dragOffset.x;
            let newY = clientY - dragOffset.y;
            
            // Contraintes pour rester dans la fen√™tre
            const maxX = window.innerWidth - coefficientDisplay.offsetWidth;
            const maxY = window.innerHeight - coefficientDisplay.offsetHeight;
            
            newX = Math.max(0, Math.min(newX, maxX));
            newY = Math.max(0, Math.min(newY, maxY));
            
            coefficientDisplay.style.left = newX + 'px';
            coefficientDisplay.style.top = newY + 'px';
            coefficientDisplay.style.right = 'auto';
        }

        function stopDrag() {
            if (!isDragging) return;
            
            isDragging = false;
            const coefficientDisplay = document.getElementById('coefficientDisplay');
            
            coefficientDisplay.classList.remove('dragging');
            coefficientDisplay.style.transition = 'box-shadow 0.2s ease';
            
            // Sauvegarder la position dans le localStorage
            const rect = coefficientDisplay.getBoundingClientRect();
            localStorage.setItem('coefficientPosition', JSON.stringify({
                left: rect.left,
                top: rect.top
            }));
        }

        // Fonction pour restaurer la position du coefficient
        function restoreCoefficientPosition() {
            const savedPosition = localStorage.getItem('coefficientPosition');
            if (savedPosition) {
                try {
                    const position = JSON.parse(savedPosition);
                    const coefficientDisplay = document.getElementById('coefficientDisplay');
                    
                    // V√©rifier que la position est valide pour la taille actuelle de la fen√™tre
                    const maxX = window.innerWidth - 120; // largeur minimale du coefficient
                    const maxY = window.innerHeight - 100; // hauteur minimale du coefficient
                    
                    if (position.left >= 0 && position.left <= maxX && position.top >= 0 && position.top <= maxY) {
                        coefficientDisplay.style.left = position.left + 'px';
                        coefficientDisplay.style.top = position.top + 'px';
                        coefficientDisplay.style.right = 'auto';
                    }
                } catch (error) {
                    console.log('Erreur lors de la restauration de la position du coefficient');
                }
            }
        }

        // Gestion du statut de connexion
        function updateConnectionStatus(status, message = '') {
            const statusEl = document.getElementById('connectionStatus');
            const icon = statusEl.querySelector('i');
            const text = statusEl.querySelector('span');
            
            statusEl.className = `connection-status ${status}`;
            
            switch(status) {
                case 'connected':
                    icon.className = 'fas fa-wifi';
                    text.textContent = 'Connect√©';
                    connectionAttempts = 0;
                    break;
                case 'connecting':
                    icon.className = 'fas fa-spinner fa-spin';
                    text.textContent = 'Connexion...';
                    break;
                case 'disconnected':
                    icon.className = 'fas fa-wifi-slash';
                    text.textContent = message || 'D√©connect√©';
                    break;
            }
        }

        // Fonctions de gestion du graphique
        function initRangeChart() {
            const ctx = document.getElementById('rangeChart').getContext('2d');
            
            rangeChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Pourcentage actuel',
                        data: [],
                        borderColor: '#4361ee',
                        backgroundColor: 'rgba(67, 97, 238, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Moyenne',
                        data: [],
                        borderColor: '#f39c12',
                        backgroundColor: 'rgba(243, 156, 18, 0.1)',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: false,
                        tension: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Temps'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Pourcentage (%)'
                            },
                            beginAtZero: true,
                            max: 100
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        function updateRangeSelector() {
            const selector = document.getElementById('rangeSelector');
            selector.innerHTML = '<option value="">S√©lectionner une plage...</option>';
            
            currentRanges.forEach(range => {
                const option = document.createElement('option');
                option.value = range.name;
                option.textContent = range.name;
                selector.appendChild(option);
            });
        }

        function displayRangeStats(rangeName) {
            const statsDisplay = document.getElementById('rangeStatsDisplay');
            const data = rangeData[rangeName];
            
            if (!data) {
                statsDisplay.innerHTML = '<p>Aucune donn√©e disponible pour cette plage.</p>';
                return;
            }
            
            const currentPercentage = data.currentPercentage || 0;
            const averagePercentage = data.averagePercentage || 0;
            const difference = currentPercentage - averagePercentage;
            
            let differenceClass = 'neutral';
            let differenceIcon = 'fas fa-equals';
            let differenceText = 'Stable';
            
            if (difference > 0.5) {
                differenceClass = 'positive';
                differenceIcon = 'fas fa-arrow-up';
                differenceText = `+${difference.toFixed(2)}%`;
            } else if (difference < -0.5) {
                differenceClass = 'negative';
                differenceIcon = 'fas fa-arrow-down';
                differenceText = `${difference.toFixed(2)}%`;
            } else {
                differenceText = `${difference.toFixed(2)}%`;
            }
            
            statsDisplay.innerHTML = `
                <div class="range-stat-card">
                    <div class="range-stat-title">Pourcentage actuel</div>
                    <div class="range-stat-value">${currentPercentage.toFixed(2)}%</div>
                </div>
                <div class="range-stat-card">
                    <div class="range-stat-title">Moyenne historique</div>
                    <div class="range-stat-value">${averagePercentage.toFixed(2)}%</div>
                </div>
                <div class="range-stat-card">
                    <div class="range-stat-title">Diff√©rence</div>
                    <div class="range-stat-value">
                        <i class="${differenceIcon}"></i> 
                        <span class="range-stat-difference ${differenceClass}">${differenceText}</span>
                    </div>
                </div>
                <div class="range-stat-card">
                    <div class="range-stat-title">Historique</div>
                    <div class="range-stat-value">${data.historySize || 0} points</div>
                </div>
            `;
        }

        function updateRangeChart(rangeName) {
            const data = rangeData[rangeName];
            if (!data || !rangeChart) return;
            
            const history = data.percentageHistory || [];
            const average = data.averagePercentage || 0;
            
            // Pr√©parer les donn√©es pour le graphique
            const labels = [];
            const currentData = [];
            const averageData = [];
            
            for (let i = Math.min(history.length, 50) - 1; i >= 0; i--) {
                labels.push(`-${i}`);
                currentData.push(history[history.length - 1 - i] || 0);
                averageData.push(average);
            }
            
            rangeChart.data.labels = labels;
            rangeChart.data.datasets[0].data = currentData;
            rangeChart.data.datasets[1].data = averageData;
            
            // Mettre √† jour les couleurs selon la plage
            const range = currentRanges.find(r => r.name === rangeName);
            if (range) {
                rangeChart.data.datasets[0].borderColor = range.color;
                rangeChart.data.datasets[0].backgroundColor = range.color + '20';
            }
            
            rangeChart.update('none'); // Animation d√©sactiv√©e pour une mise √† jour fluide
            
            // Mettre √† jour la l√©gende
            updateChartLegend();
        }

        function updateChartLegend() {
            const legendContainer = document.getElementById('chartLegend');
            legendContainer.innerHTML = `
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #4361ee;"></div>
                    <span>Pourcentage actuel</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #f39c12;"></div>
                    <span>Moyenne historique</span>
                </div>
            `;
        }

        function handleRangeSelection() {
            const selector = document.getElementById('rangeSelector');
            selectedRangeName = selector.value;
            
            if (selectedRangeName) {
                displayRangeStats(selectedRangeName);
                updateRangeChart(selectedRangeName);
                
                // üîç Afficher l'analyse des pics et creux pour cette range
                if (picsCreuxData[selectedRangeName]) {
                    displayPicsCreuxForRange(selectedRangeName, picsCreuxData[selectedRangeName]);
                } else {
                    document.getElementById('picsCreuxSection').style.display = 'none';
                }

                // üî• Afficher l'analyse des chutes et mont√©es pour cette range
                if (chutesMonteeData[selectedRangeName]) {
                    displayChutesMonteeForRange(selectedRangeName, chutesMonteeData[selectedRangeName]);
                } else {
                    document.getElementById('chutesMonteeSection').style.display = 'none';
                }

                // üÜï Afficher l'analyse des pics et creux l√©gers pour cette range
                if (picsCreuxLegersData[selectedRangeName]) {
                    displayPicsCreuxLegersForRange(selectedRangeName, picsCreuxLegersData[selectedRangeName]);
                } else {
                    document.getElementById('picsCreuxLegersSection').style.display = 'none';
                }

                // üî• Afficher l'analyse des plateaux pour cette range
                if (plateauxData[selectedRangeName]) {
                    displayPlateauxForRange(selectedRangeName, plateauxData[selectedRangeName]);
                } else {
                    document.getElementById('plateauxSection').style.display = 'none';
                }

                // üå°Ô∏è Afficher l'analyse du thermom√®tre pour cette range
                if (thermometreData[selectedRangeName]) {
                    displayThermometreForRange(selectedRangeName, thermometreData[selectedRangeName]);
                } else {
                    document.getElementById('thermometreSection').style.display = 'none';
                }

                // üìä Afficher le classement des pourcentages pour cette range
                displayClassementForRange(selectedRangeName);

                // üéØ Actualiser les pr√©dictions lors de la s√©lection d'une range
                refreshPredictions();
            } else {
                document.getElementById('rangeStatsDisplay').innerHTML = '';
                document.getElementById('picsCreuxSection').style.display = 'none';
                document.getElementById('chutesMonteeSection').style.display = 'none';
                document.getElementById('picsCreuxLegersSection').style.display = 'none';
                document.getElementById('plateauxSection').style.display = 'none';
                document.getElementById('thermometreSection').style.display = 'none';
                document.getElementById('classementSection').style.display = 'none';
                document.getElementById('predictionSection').style.display = 'none';
                if (rangeChart) {
                    rangeChart.data.labels = [];
                    rangeChart.data.datasets[0].data = [];
                    rangeChart.data.datasets[1].data = [];
                    rangeChart.update('none');
                }
                document.getElementById('chartLegend').innerHTML = '';
            }
        }

        // Auto-refresh du graphique lors de nouvelles donn√©es
        function autoRefreshChart() {
            if (selectedRangeName && rangeData[selectedRangeName]) {
                // Animer la mise √† jour automatique fluide
                animateAutoUpdate();
                
                displayRangeStats(selectedRangeName);
                updateRangeChart(selectedRangeName);
                
                // üîç Auto-refresh de l'analyse des pics et creux
                if (picsCreuxData[selectedRangeName]) {
                    displayPicsCreuxForRange(selectedRangeName, picsCreuxData[selectedRangeName]);
                }

                // üî• Auto-refresh de l'analyse des chutes et mont√©es
                if (chutesMonteeData[selectedRangeName]) {
                    displayChutesMonteeForRange(selectedRangeName, chutesMonteeData[selectedRangeName]);
                }

                // üÜï Auto-refresh de l'analyse des pics et creux l√©gers
                if (picsCreuxLegersData[selectedRangeName]) {
                    displayPicsCreuxLegersForRange(selectedRangeName, picsCreuxLegersData[selectedRangeName]);
                }

                // üî• Auto-refresh de l'analyse des plateaux
                if (plateauxData[selectedRangeName]) {
                    displayPlateauxForRange(selectedRangeName, plateauxData[selectedRangeName]);
                }

                // üå°Ô∏è Auto-refresh de l'analyse du thermom√®tre
                if (thermometreData[selectedRangeName]) {
                    displayThermometreForRange(selectedRangeName, thermometreData[selectedRangeName]);
                }

                // üìä Auto-refresh du classement des pourcentages
                if (selectedRangeName) {
                    displayClassementForRange(selectedRangeName);
                }
            }
        }

        // Initialiser l'application
        document.addEventListener('DOMContentLoaded', () => {
            // V√©rifier si l'utilisateur est connect√©
            if (localStorage.getItem('isLoggedIn') === 'true') {
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('usernameDisplay').textContent = localStorage.getItem('username') || 'Utilisateur';
                initSocket();
            } else {
                document.getElementById('loginOverlay').style.display = 'flex';
                updateConnectionStatus('disconnected', 'Non connect√©');
            }
            
            // Charger les param√®tres sonores
            loadSoundSettings();
            
            // Initialiser l'affichage des plages par d√©faut m√™me sans connexion
            renderRanges();
            updateRangeSelector();
            initRangeChart();

            // Gestionnaires d'√©v√©nements
            document.getElementById('medianSize').addEventListener('change', updateCustomSizes);
            document.getElementById('meanSize').addEventListener('change', updateCustomSizes);
            document.getElementById('resetStatsBtn').addEventListener('click', resetStatistics);
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            document.getElementById('pollingToggle').addEventListener('change', togglePolling);
            document.getElementById('historySize').addEventListener('change', setHistorySize);
            document.getElementById('pollingFreq').addEventListener('change', setPollingFrequency);
            document.getElementById('itemsPerPage').addEventListener('change', changeItemsPerPage);
            document.getElementById('medianSize').addEventListener('change', analyzeData);
            document.getElementById('meanSize').addEventListener('change', analyzeData);
            document.getElementById('placeBetBtn').addEventListener('click', placeBet);
            document.getElementById('floatingBetBtn').addEventListener('click', placeDirectBet);
            document.getElementById('quickPlaceBetBtn').addEventListener('click', placeQuickBet);
            document.querySelector('.quick-bet-close').addEventListener('click', closeQuickBetModal);
            document.getElementById('addRangeBtn').addEventListener('click', openRangeModal);
            document.getElementById('saveRangeBtn').addEventListener('click', saveRange);
            document.querySelector('.close').addEventListener('click', closeRangeModal);
            document.getElementById('toggleSettings').addEventListener('click', toggleSettings);
            document.getElementById('authToken').addEventListener('change', updateAuthToken);
            document.querySelector('.toggle-password').addEventListener('click', togglePasswordVisibility);
            document.getElementById('rangeColor').addEventListener('input', updateColorPreview);
            document.getElementById('prevPageBtn').addEventListener('click', goToPreviousPage);
            document.getElementById('nextPageBtn').addEventListener('click', goToNextPage);
            
            // Gestionnaires pour le graphique
            document.getElementById('rangeSelector').addEventListener('change', handleRangeSelection);
            
            // Gestionnaires pour les notifications sonores
            document.getElementById('soundNotifications').addEventListener('change', updateSoundSettings);
            document.getElementById('soundVolume').addEventListener('input', () => {
                soundVolume = document.getElementById('soundVolume').value / 100;
                document.getElementById('volumeDisplay').textContent = Math.round(soundVolume * 100) + '%';
                localStorage.setItem('soundVolume', soundVolume);
            });

            // üìä Gestionnaires pour le classement des pourcentages
            document.getElementById('searchPercentageBtn').addEventListener('click', searchPercentageInRange);
            document.getElementById('searchPercentageInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchPercentageInRange();
                }
            });
            document.getElementById('showTopPercentagesBtn').addEventListener('click', () => {
                if (selectedRangeName && isConnected) {
                    socket.emit('message', {
                        type: 'getTopPercentagesForRange',
                        rangeName: selectedRangeName,
                        limit: 10
                    });
                    document.getElementById('searchResults').classList.remove('show');
                } else {
                    afficherNotification("‚ùå Veuillez d'abord s√©lectionner une range", "#e74c3c");
                }
            });
            document.getElementById('refreshClassementBtn').addEventListener('click', refreshClassement);

            // üéØ Gestionnaires pour les pr√©dictions IA
            document.getElementById('refreshPredictionBtn').addEventListener('click', refreshPredictions);
            document.getElementById('viewTransitionAnalysisBtn').addEventListener('click', viewTransitionAnalysis);
            document.getElementById('viewMomentumAnalysisBtn').addEventListener('click', viewMomentumAnalysis);
            document.getElementById('clearPredictionHistoryBtn').addEventListener('click', clearPredictionHistory);
            
            // Initialiser le syst√®me de d√©placement du coefficient
            initCoefficientDragging();
            restoreCoefficientPosition();
            
            // Fermer les modals si on clique en dehors
            window.addEventListener('click', (e) => {
                const rangeModal = document.getElementById('rangeModal');
                const quickBetModal = document.getElementById('quickBetModal');
                if (e.target === rangeModal) {
                    closeRangeModal();
                } else if (e.target === quickBetModal) {
                    closeQuickBetModal();
                }
            });

            // Ajuster la position du coefficient lors du redimensionnement de la fen√™tre
            window.addEventListener('resize', () => {
                if (document.getElementById('coefficientDisplay').style.left !== '') {
                    const coefficientDisplay = document.getElementById('coefficientDisplay');
                    const rect = coefficientDisplay.getBoundingClientRect();
                    
                    const maxX = window.innerWidth - coefficientDisplay.offsetWidth;
                    const maxY = window.innerHeight - coefficientDisplay.offsetHeight;
                    
                    if (rect.left > maxX) {
                        coefficientDisplay.style.left = maxX + 'px';
                    }
                    if (rect.top > maxY) {
                        coefficientDisplay.style.top = maxY + 'px';
                    }
                }
                
                // Redimensionner le graphique
                if (rangeChart) {
                    rangeChart.resize();
                }
            });

            // Mettre √† jour le statut de connexion initial
            updateConnectionStatus('disconnected');
            
            // Initialiser l'audio sur interaction utilisateur
            document.addEventListener('click', () => {
                if (!audioContext) {
                    initAudioSystem();
                }
            }, { once: true });
        });

        function updateCustomSizes() {
            if (!isConnected) return;
            
            socket.emit('message', {
                type: 'updateCustomSizes',
                customSizes: {
                    median: parseInt(document.getElementById('medianSize').value),
                    mean: parseInt(document.getElementById('meanSize').value)
                }
            });
        }

        function resetStatistics() {
            if (!isConnected) {
                afficherNotification("‚ùå Non connect√© au serveur", "#e74c3c");
                return;
            }
            
            // Cr√©er une modal de confirmation personnalis√©e
            showConfirmDialog("Voulez-vous vraiment r√©initialiser toutes les statistiques?\nCette action est irr√©versible.", () => {
                socket.emit('message', { type: 'clearMedianMeanHistory' });
                afficherNotification("üîÑ R√©initialisation en cours...", "#3498db");
            });
        }

        // Fonction pour cr√©er une modal de confirmation personnalis√©e
        function showConfirmDialog(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 400px;">
                    <div class="modal-header">
                        <h3><i class="fas fa-exclamation-triangle"></i> Confirmation</h3>
                    </div>
                    <div class="modal-body">
                        <p style="margin-bottom: 1.5rem; line-height: 1.5; white-space: pre-line;">${message}</p>
                        <div style="display: flex; gap: 1rem;">
                            <button class="btn btn-secondary full-width cancel-btn">
                                <i class="fas fa-times"></i> Annuler
                            </button>
                            <button class="btn secondary-btn full-width confirm-btn">
                                <i class="fas fa-check"></i> Confirmer
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const cancelBtn = modal.querySelector('.cancel-btn');
            const confirmBtn = modal.querySelector('.confirm-btn');
            
            cancelBtn.addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            confirmBtn.addEventListener('click', () => {
                document.body.removeChild(modal);
                onConfirm();
            });
            
            // Fermer en cliquant en dehors
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }

        // Fonction pour mettre √† jour l'auth token
        function updateAuthToken() {
            if (!isConnected) return;
            
            const authToken = document.getElementById('authToken').value;
            if (authToken) {
                socket.emit('message', {
                    type: 'updateAuthToken',
                    authToken: authToken
                });
            }
        }

        // G√©rer la connexion
        async function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorEl = document.getElementById('loginError');
            
            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    localStorage.setItem('isLoggedIn', 'true');
                    localStorage.setItem('username', username);
                    
                    // Stocker et afficher les informations utilisateur
                    if (data.userInfo) {
                        userInfo = data.userInfo;
                        document.getElementById('usernameDisplay').textContent = userInfo.userName || username;
                    } else {
                        document.getElementById('usernameDisplay').textContent = username;
                    }
                    
                    document.getElementById('loginOverlay').style.display = 'none';
                    initSocket();
                } else {
                    errorEl.textContent = data.message || 'Identifiants incorrects';
                    errorEl.style.display = 'block';
                }
            } catch (error) {
                errorEl.textContent = 'Erreur de connexion au serveur';
                errorEl.style.display = 'block';
                console.error('Erreur de connexion:', error);
            }
        }

        // G√©rer la d√©connexion
        function handleLogout() {
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('username');
            if (socket) {
                socket.disconnect();
            }
            if (reconnectTimeout) {
                clearTimeout(reconnectTimeout);
            }
            window.location.reload();
        }

        // Initialiser la connexion Socket.IO avec gestion am√©lior√©e des erreurs
        function initSocket() {
            updateConnectionStatus('connecting');
            
            socket = io({
                timeout: 20000,
                forceNew: true,
                reconnection: true,
                reconnectionDelay: 1000,
                reconnectionDelayMax: 5000,
                reconnectionAttempts: maxConnectionAttempts
            });
            
            socket.on('connect', () => {
                console.log('Socket.IO connect√©');
                isConnected = true;
                updateConnectionStatus('connected');
                afficherNotification("‚úÖ Connect√© au serveur", "#2ecc71");
                updateBalance();
            });

            socket.on('customSizesUpdated', (message) => {
                if (message.success) {
                    console.log('Tailles mises √† jour:', message.customSizes);
                    afficherNotification("‚úÖ Tailles sauvegard√©es", "#2ecc71");
                }
            });

            // Gestionnaire pour l'auth token mis √† jour
            socket.on('authTokenUpdated', (message) => {
                if (message.success) {
                    afficherNotification("‚úÖ Auth token mis √† jour", "#2ecc71");
                } else {
                    afficherNotification("‚ùå " + message.message, "#e74c3c");
                }
            });

            // Gestion de la r√©ponse du serveur pour la r√©initialisation
            socket.on('medianMeanHistoryCleared', (message) => {
                if (message.success) {
                    afficherNotification("‚úÖ Statistiques r√©initialis√©es", "#2ecc71");
                    analyzeData();
                } else {
                    afficherNotification("‚ùå √âchec de la r√©initialisation", "#e74c3c");
                }
            });

            // üéØ Gestionnaires pour les pr√©dictions IA
            socket.on('crashPredictionData', (message) => {
                if (message.data) {
                    processPredictionData(message.data);
                }
            });

            socket.on('rankingEvolutionData', (message) => {
                if (message.data) {
                    console.log('üéØ Donn√©es d\'√©volution du classement re√ßues:', message.data);
                    afficherNotification(`üìä Analyse des transitions pour ${message.data.rangeName}`, "#3498db");
                    // Ici on pourrait ouvrir une modal avec les d√©tails
                }
            });

            socket.on('predictionHistoryCleared', (message) => {
                if (message.success) {
                    afficherNotification("‚úÖ Historique pr√©dictif effac√©", "#2ecc71");
                    currentPredictions = {};
                    predictionHistory = [];
                    document.getElementById('predictionSection').style.display = 'none';
                }
            });

            // üìä Gestionnaires pour le classement des pourcentages
            socket.on('percentageRankingData', (message) => {
                if (message.data) {
                    processPercentageRankingData(message.data);
                }
            });

            socket.on('topPercentagesData', (message) => {
                if (message.data && message.data.topPercentages) {
                    displayTopPercentages(message.data.topPercentages, message.data.rangeName);
                    document.getElementById('searchResults').classList.remove('show');
                }
            });

            socket.on('percentageSearchResult', (message) => {
                if (message.data) {
                    displaySearchResults(message.data);
                }
            });
            
            socket.on('init', (message) => {
                crashHistory = message.data.history || [];
                document.getElementById('historySize').value = message.data.historySize;
                document.getElementById('pollingToggle').checked = message.data.isPolling;

                const medianSize = message.data.customSizes?.median;
                const meanSize = message.data.customSizes?.mean;
                document.getElementById('medianSize').value = medianSize;
                document.getElementById('meanSize').value = meanSize;

                // Traiter les informations utilisateur et coefficient
                if (message.data.userInfo) {
                    userInfo = message.data.userInfo;
                    document.getElementById('usernameDisplay').textContent = userInfo.userName || 'Utilisateur';
                }

                if (message.data.currentCoefficient !== null && message.data.currentCoefficient !== undefined) {
                    currentCoefficient = message.data.currentCoefficient;
                    updateCoefficientDisplay(currentCoefficient);
                }
                  
                if (message.data.ranges) {
                    currentRanges = message.data.ranges;
                }
                
                // üîç Traiter les donn√©es de pics et creux √† l'initialisation
                if (message.data.picsCreuxAnalysis && message.data.picsCreuxGlobalSummary) {
                    processPicsCreuxData(message.data.picsCreuxAnalysis, message.data.picsCreuxGlobalSummary);
                }

                // üî• Traiter les donn√©es de chutes et mont√©es √† l'initialisation
                if (message.data.chutesMonteeAnalysis && message.data.chutesMonteeGlobalSummary) {
                    processChutesMonteeData(message.data.chutesMonteeAnalysis, message.data.chutesMonteeGlobalSummary);
                }

                // üÜï Traiter les donn√©es de pics et creux l√©gers √† l'initialisation
                if (message.data.picsCreuxLegersAnalysis && message.data.picsCreuxLegersGlobalSummary) {
                    processPicsCreuxLegersData(message.data.picsCreuxLegersAnalysis, message.data.picsCreuxLegersGlobalSummary);
                }

                // üî• Traiter les donn√©es de plateaux √† l'initialisation
                if (message.data.plateauxAnalysis && message.data.plateauxGlobalSummary) {
                    processPlateauxData(message.data.plateauxAnalysis, message.data.plateauxGlobalSummary);
                }

                // üå°Ô∏è Traiter les donn√©es du thermom√®tre √† l'initialisation
                if (message.data.thermometreAnalysis && message.data.thermometreGlobalSummary) {
                    processThermometreData(message.data.thermometreAnalysis, message.data.thermometreGlobalSummary);
                }

                // üìä Traiter les donn√©es de classement des pourcentages √† l'initialisation
                if (message.data.percentageRankingData) {
                    processPercentageRankingData(message.data.percentageRankingData);
                }

                // üéØ Traiter les pr√©dictions IA √† l'initialisation
                if (message.data.nextCrashPrediction) {
                    processPredictionData(message.data.nextCrashPrediction);
                }
                
                renderRanges();
                updateRangeSelector();
                updatePagination();
                renderHistory();
                analyzeData();
            });

            // Gestionnaire pour les mises √† jour de coefficient
            socket.on('coefficientUpdate', (message) => {
                if (message.coefficient !== null && message.coefficient !== undefined) {
                    currentCoefficient = message.coefficient;
                    updateCoefficientDisplay(currentCoefficient);
                    console.log('üìà Coefficient mis √† jour:', currentCoefficient);
                }
            });
            
            socket.on('update', (message) => {
                console.log('Mise √† jour re√ßue:', message.data);
                if (message.data.newValues && message.data.newValues.length > 0) {
                    crashHistory = message.data.history;
                    console.log('Historique mis √† jour:', crashHistory.length, '√©l√©ments');
                    
                    // Jouer le son de notification si activ√©
                    if (message.data.playNotificationSound) {
                        playNotificationSound();
                    }
                    
                    if (message.data.rangePercentages) {
                        displayRangePercentages(message.data.rangePercentages);
                        rangeData = message.data.rangePercentages;
                        
                        // Auto-refresh du graphique
                        if (message.data.autoRefreshChart) {
                            autoRefreshChart();
                        }
                    }
                    
                    // üîç Traiter les nouvelles donn√©es de pics et creux
                    if (message.data.picsCreuxAnalysis && message.data.picsCreuxGlobalSummary) {
                        processPicsCreuxData(message.data.picsCreuxAnalysis, message.data.picsCreuxGlobalSummary);
                    }

                    // üî• Traiter les nouvelles donn√©es de chutes et mont√©es
                    if (message.data.chutesMonteeAnalysis && message.data.chutesMonteeGlobalSummary) {
                        processChutesMonteeData(message.data.chutesMonteeAnalysis, message.data.chutesMonteeGlobalSummary);
                    }

                    // üÜï Traiter les nouvelles donn√©es de pics et creux l√©gers
                    if (message.data.picsCreuxLegersAnalysis && message.data.picsCreuxLegersGlobalSummary) {
                        processPicsCreuxLegersData(message.data.picsCreuxLegersAnalysis, message.data.picsCreuxLegersGlobalSummary);
                    }

                    // üî• Traiter les nouvelles donn√©es de plateaux
                    if (message.data.plateauxAnalysis && message.data.plateauxGlobalSummary) {
                        processPlateauxData(message.data.plateauxAnalysis, message.data.plateauxGlobalSummary);
                    }

                    // üå°Ô∏è Traiter les nouvelles donn√©es du thermom√®tre
                    if (message.data.thermometreAnalysis && message.data.thermometreGlobalSummary) {
                        processThermometreData(message.data.thermometreAnalysis, message.data.thermometreGlobalSummary);
                    }

                    // üìä Traiter les nouvelles donn√©es de classement des pourcentages
                    if (message.data.percentageRankingData) {
                        processPercentageRankingData(message.data.percentageRankingData);
                    }

                    // üéØ Traiter les nouvelles pr√©dictions IA
                    if (message.data.nextCrashPrediction) {
                        processPredictionData(message.data.nextCrashPrediction);
                    }
                    
                    updatePagination();
                    renderHistory();
                    analyzeData();
                    updateBalance();
                    updateLastUpdated();
                    afficherNotification(`‚úÖ ${message.data.newValues.length} nouvelles donn√©es r√©cup√©r√©es`, "#2ecc71");
                }
            });
            
            socket.on('balance', (message) => {
                if (message.data !== null && !isNaN(message.data)) {
                    document.getElementById('soldeAffichage').innerHTML = `<i class="fas fa-coins"></i> <span>${message.data} FCFA</span>`;
                } else {
                    document.getElementById('soldeAffichage').innerHTML = `<i class="fas fa-exclamation-triangle"></i> <span>Erreur</span>`;
                }
            });
            
            socket.on('betResult', (message) => {
                handleBetResult(message.data);
            });
            
            socket.on('analysis', (message) => {
                displayAnalysis(message.data);
            });
            
            socket.on('rangesSaved', (message) => {
                if (message.success) {
                    afficherNotification("‚úÖ Plages sauvegard√©es", "#2ecc71");
                    currentRanges = message.ranges;
                    renderRanges();
                    updateRangeSelector();
                } else {
                    afficherNotification("‚ùå Erreur: " + (message.message || "Impossible de sauvegarder"), "#e74c3c");
                }
            });
            
            socket.on('rangesData', (message) => {
                currentRanges = message.ranges;
                renderRanges();
                updateRangeSelector();
            });
            
            socket.on('error', (message) => {
                afficherNotification("‚ùå " + message.message, "#e74c3c");
            });
            
            socket.on('connect_error', (error) => {
                console.error('Erreur de connexion Socket.IO:', error);
                isConnected = false;
                updateConnectionStatus('disconnected', 'Erreur de connexion');
                
                connectionAttempts++;
                if (connectionAttempts >= maxConnectionAttempts) {
                    afficherNotification("‚ùå Impossible de se connecter au serveur", "#e74c3c");
                    updateConnectionStatus('disconnected', 'Connexion √©chou√©e');
                }
            });
            
            socket.on('disconnect', (reason) => {
                console.log('Socket.IO d√©connect√©:', reason);
                isConnected = false;
                updateConnectionStatus('disconnected', 'Connexion perdue');
                
                // Masquer le coefficient lors de la d√©connexion
                updateCoefficientDisplay(null);
                
                if (reason === 'io server disconnect') {
                    afficherNotification("üîå D√©connect√© par le serveur", "#f39c12");
                } else {
                    afficherNotification("üîå Connexion perdue", "#f39c12");
                }
                
                // Tentative de reconnexion automatique
                if (localStorage.getItem('isLoggedIn') === 'true') {
                    reconnectTimeout = setTimeout(() => {
                        if (!isConnected) {
                            updateConnectionStatus('connecting');
                            afficherNotification("üîÑ Tentative de reconnexion...", "#3498db");
                        }
                    }, 3000);
                }
            });
            
            socket.on('rangePercentagesData', (message) => {
                displayRangePercentages(message.data);
                rangeData = message.data;
                
                // Auto-refresh du graphique
                autoRefreshChart();
            });
        }

        // Fonctions de contr√¥le
        function togglePolling(e) {
            if (!isConnected) {
                afficherNotification("‚ùå Non connect√© au serveur", "#e74c3c");
                e.target.checked = !e.target.checked; // Remettre le switch dans sa position pr√©c√©dente
                return;
            }
            
            if (e.target.checked) {
                socket.emit('message', { type: 'startPolling' });
                afficherNotification("‚úÖ Mise √† jour automatique activ√©e", "#2ecc71");
            } else {
                socket.emit('message', { type: 'stopPolling' });
                afficherNotification("‚è∏Ô∏è Mise √† jour automatique d√©sactiv√©e", "#f39c12");
            }
        }

        function setHistorySize(e) {
            if (!isConnected) return;
            
            const size = parseInt(e.target.value);
            if (size >= 10 && size <= 10000) {
                socket.emit('message', { type: 'setHistorySize', size });
                afficherNotification("‚úÖ Taille d'historique modifi√©e: " + size, "#2ecc71");
            }
        }

        function setPollingFrequency(e) {
            if (!isConnected) return;
            
            const frequency = parseInt(e.target.value);
            if (frequency >= 500 && frequency <= 10000) {
                socket.emit('message', { type: 'setPollingFrequency', frequency });
                afficherNotification("‚úÖ Fr√©quence modifi√©e: " + frequency + "ms", "#2ecc71");
            }
        }

        function updateBalance() {
            if (!isConnected) return;
            
            socket.emit('message', { type: 'getBalance' });
        }

        function placeBet() {
            if (!isConnected) {
                afficherNotification("‚ùå Non connect√© au serveur", "#e74c3c");
                return;
            }
            
            const amount = parseFloat(document.getElementById('betAmount').value);
            const autoCash = parseFloat(document.getElementById('autoCashout').value);
            
            if (isNaN(amount) || amount <= 0) {
                afficherNotification("‚ùå Montant invalide", "#e74c3c");
                return;
            }
            
            if (isNaN(autoCash) || autoCash < 1.01) {
                afficherNotification("‚ùå Auto cashout invalide", "#e74c3c");
                return;
            }
            
            afficherNotification("‚è≥ Envoi du pari...", "#3498db");
            
            socket.emit('message', {
                type: 'placeBet',
                amount,
                autoCash
            });
        }

        function openQuickBetModal() {
            const quickBetModal = document.getElementById('quickBetModal');
            
            document.getElementById('quickBetAmount').value = document.getElementById('betAmount').value;
            document.getElementById('quickAutoCashout').value = document.getElementById('autoCashout').value;
            
            quickBetModal.style.display = 'flex';
        }

        function closeQuickBetModal() {
            document.getElementById('quickBetModal').style.display = 'none';
        }

        function placeQuickBet() {
            if (!isConnected) {
                afficherNotification("‚ùå Non connect√© au serveur", "#e74c3c");
                return;
            }
            
            const amount = parseFloat(document.getElementById('quickBetAmount').value);
            const autoCash = parseFloat(document.getElementById('quickAutoCashout').value);
            
            if (isNaN(amount) || amount <= 0) {
                afficherNotification("‚ùå Montant invalide", "#e74c3c");
                return;
            }
            
            if (isNaN(autoCash) || autoCash < 1.01) {
                afficherNotification("‚ùå Auto cashout invalide", "#e74c3c");
                return;
            }
            
            afficherNotification("‚è≥ Envoi du pari rapide...", "#3498db");
            
            socket.emit('message', {
                type: 'placeBet',
                amount,
                autoCash
            });
            
            closeQuickBetModal();
        }

        function placeDirectBet() {
            if (!isConnected) {
                afficherNotification("‚ùå Non connect√© au serveur", "#e74c3c");
                return;
            }
            
            openQuickBetModal();
        }

        function handleBetResult(data) {
            console.log('R√©sultat du pari:', data);
            
            if (data.status === "success") {
                const betId = data.bet?.id || "inconnu";
                afficherNotification("‚úÖ Pari accept√© -- ID: " + betId, "#2ecc71");
                updateBalance();
            } else if (data.status === "error") {
                let message = "‚ùå Erreur: ";
                
                if (data.code === 37 || data.error === "Insufficient balance.") {
                    message += "Solde insuffisant";
                } else {
                    message += data.error || data.message || "√©chec du pari";
                }
                
                afficherNotification(message, "#e74c3c");
            } else {
                afficherNotification("‚ùå R√©ponse inattendue du serveur", "#e74c3c");
            }
        }

        // Fonctions de pagination
        function updatePagination() {
            totalPages = Math.ceil(crashHistory.length / itemsPerPage);
            document.getElementById('totalPages').textContent = totalPages;
            
            if (currentPage > totalPages && totalPages > 0) {
                currentPage = totalPages;
            }
            
            document.getElementById('currentPage').textContent = currentPage;
            document.getElementById('prevPageBtn').disabled = currentPage <= 1;
            document.getElementById('nextPageBtn').disabled = currentPage >= totalPages;
            
            document.getElementById('totalValueCount').textContent = crashHistory.length;
        }

        function goToPreviousPage() {
            if (currentPage > 1) {
                currentPage--;
                document.getElementById('currentPage').textContent = currentPage;
                document.getElementById('prevPageBtn').disabled = currentPage <= 1;
                document.getElementById('nextPageBtn').disabled = false;
                renderHistory();
            }
        }

        function goToNextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                document.getElementById('currentPage').textContent = currentPage;
                document.getElementById('prevPageBtn').disabled = false;
                document.getElementById('nextPageBtn').disabled = currentPage >= totalPages;
                renderHistory();
            }
        }

        function changeItemsPerPage() {
            itemsPerPage = parseInt(document.getElementById('itemsPerPage').value);
            currentPage = 1;
            updatePagination();
            renderHistory();
        }

        // Fonctions d'affichage
        function renderHistory() {
            const historyContainer = document.getElementById('historyValues');
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, crashHistory.length);
            const displayHistory = crashHistory.slice(startIndex, endIndex);
            
            historyContainer.innerHTML = '';
            
            displayHistory.forEach(value => {
                const item = document.createElement('div');
                item.className = 'history-item';
                item.textContent = value.toFixed(2);
                
                let bgColor = '#95a5a6';
                
                for (const range of currentRanges) {
                    const { min, max, color } = range;
                    
                    if (min !== null && max !== null) {
                        if (value >= min && value < max) {
                            bgColor = color;
                            break;
                        }
                    } else if (min !== null) {
                        if (value >= min) {
                            bgColor = color;
                            break;
                        }
                    } else if (max !== null) {
                        if (value < max) {
                            bgColor = color;
                            break;
                        }
                    }
                }
                
                item.style.backgroundColor = bgColor;
                historyContainer.appendChild(item);
            });
        }

        function analyzeData() {
            if (!isConnected || crashHistory.length === 0) return;
            
            const medianSize = parseInt(document.getElementById('medianSize').value) || crashHistory.length;
            const meanSize = parseInt(document.getElementById('meanSize').value) || crashHistory.length;
            
            const rangesWithLimits = currentRanges.map(range => ({
                ...range
            }));
            
            socket.emit('message', {
                type: 'analyze',
                ranges: rangesWithLimits,
                customSizes: {
                    median: medianSize,
                    mean: meanSize
                }
            });
        }

        // Rendu des plages simplifi√©
        function renderRanges() {
            const rangesContainer = document.getElementById('rangesContainer');
            rangesContainer.innerHTML = '';
            
            currentRanges.forEach((range, index) => {
                const card = document.createElement('div');
                card.className = 'range-card';
                
                const header = document.createElement('div');
                header.className = 'range-header';
                
                const title = document.createElement('div');
                title.className = 'range-title';
                
                const colorDot = document.createElement('div');
                colorDot.className = 'range-color';
                colorDot.style.backgroundColor = range.color;
                
                title.appendChild(colorDot);
                title.appendChild(document.createTextNode(range.name));
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'range-delete';
                deleteBtn.innerHTML = '<i class="fas fa-times"></i>';
                deleteBtn.addEventListener('click', () => deleteRange(range.name));
                
                header.appendChild(title);
                header.appendChild(deleteBtn);
                
                const statsDiv = document.createElement('div');
                statsDiv.className = 'range-stats';
                
                // Cr√©er les statistiques
                const countStat = document.createElement('div');
                countStat.className = 'range-stat';
                countStat.innerHTML = '<span>Occurrences</span><span id="count-' + range.name.replace(/\s+/g, '-') + '">--</span>';
                
                const percentageStat = document.createElement('div');
                percentageStat.className = 'range-stat';
                percentageStat.innerHTML = '<span>Pourcentage</span><span id="percentage-' + range.name.replace(/\s+/g, '-') + '">--%</span>';
                
                const averageStat = document.createElement('div');
                averageStat.className = 'range-stat';
                averageStat.innerHTML = '<span>Moyenne %</span><span id="average-' + range.name.replace(/\s+/g, '-') + '">--%</span>';
                
                statsDiv.appendChild(countStat);
                statsDiv.appendChild(percentageStat);
                statsDiv.appendChild(averageStat);
                
                const progress = document.createElement('div');
                progress.className = 'range-progress';
                const progressBar = document.createElement('div');
                progressBar.className = 'range-progress-bar';
                progressBar.style.backgroundColor = range.color;
                progressBar.style.width = '0%';
                progressBar.id = 'progress-' + range.name.replace(/\s+/g, '-');
                progress.appendChild(progressBar);
                
                card.appendChild(header);
                card.appendChild(statsDiv);
                card.appendChild(progress);
                
                rangesContainer.appendChild(card);
            });
        }

        function displayAnalysis(data) {
            document.getElementById('medianValue').textContent = data.median.toFixed(2);
            document.getElementById('meanValue').textContent = data.mean.toFixed(2);

            document.getElementById('medianAverageValue').textContent = data.medianOfMedians?.toFixed(2) || '--';
            document.getElementById('meanAverageValue').textContent = data.meanOfMeans?.toFixed(2) || '--';
            
            Object.entries(data.ranges).forEach(([name, stats]) => {
                const safeName = name.replace(/\s+/g, '-');
                const countEl = document.getElementById('count-' + safeName);
                const percentageEl = document.getElementById('percentage-' + safeName);
                const averageEl = document.getElementById('average-' + safeName);
                const progressEl = document.getElementById('progress-' + safeName);
                
                if (countEl) countEl.textContent = stats.count;
                if (percentageEl) percentageEl.textContent = stats.percentage.toFixed(2) + '%';
                if (averageEl) averageEl.textContent = stats.averagePercentage ? stats.averagePercentage.toFixed(1) + '%' : '--%';
                
                if (progressEl) progressEl.style.width = Math.min(stats.percentage, 100) + '%';
            });
        }

        function displayRangePercentages(data) {
            Object.entries(data).forEach(([name, stats]) => {
                const safeName = name.replace(/\s+/g, '-');
                const percentageEl = document.getElementById('percentage-' + safeName);
                const averageEl = document.getElementById('average-' + safeName);
                const progressEl = document.getElementById('progress-' + safeName);
                
                if (percentageEl) percentageEl.textContent = stats.currentPercentage.toFixed(1) + '%';
                if (averageEl) averageEl.textContent = stats.averagePercentage ? stats.averagePercentage.toFixed(1) + '%' : '--%';
                
                if (progressEl) progressEl.style.width = Math.min(stats.currentPercentage, 100) + '%';
            });
        }

        // Gestion des plages
        function openRangeModal() {
            document.getElementById('rangeModal').style.display = 'flex';
            document.getElementById('rangeName').value = '';
            document.getElementById('rangeMin').value = '';
            document.getElementById('rangeMax').value = '';
            document.getElementById('rangeColor').value = '#3498db';
            document.getElementById('rangeSize').value = '';
            updateColorPreview();
        }

        function closeRangeModal() {
            document.getElementById('rangeModal').style.display = 'none';
        }

        function saveRange() {
            const name = document.getElementById('rangeName').value.trim();
            const minStr = document.getElementById('rangeMin').value.trim();
            const maxStr = document.getElementById('rangeMax').value.trim();
            const color = document.getElementById('rangeColor').value;
            const limitStr = document.getElementById('rangeSize').value.trim();
            
            if (!name) {
                afficherNotification("‚ùå Veuillez sp√©cifier un nom pour la plage", "#e74c3c");
                return;
            }
            
            if (!minStr && !maxStr) {
                afficherNotification("‚ùå Veuillez sp√©cifier au moins une limite", "#e74c3c");
                return;
            }
            
            const min = minStr ? parseFloat(minStr) : null;
            const max = maxStr ? parseFloat(maxStr) : null;
            const limit = limitStr ? parseInt(limitStr) : null;
            
            if (min !== null && max !== null && min >= max) {
                afficherNotification("‚ùå La valeur minimale doit √™tre inf√©rieure √† la valeur maximale", "#e74c3c");
                return;
            }
            
            const existingIndex = currentRanges.findIndex(r => r.name === name);
            
            if (existingIndex !== -1) {
                currentRanges[existingIndex] = { name, min, max, color, limit };
            } else {
                currentRanges.push({ name, min, max, color, limit });
            }
            
            closeRangeModal();
            renderRanges();
            updateRangeSelector();
            analyzeData();
            
            if (isConnected) {
                socket.emit('message', { type: 'saveRanges', ranges: currentRanges });
            }
        }

        function deleteRange(name) {
            const index = currentRanges.findIndex(r => r.name === name);
            
            if (index !== -1) {
                currentRanges.splice(index, 1);
                renderRanges();
                updateRangeSelector();
                analyzeData();
                
                // Si la plage supprim√©e √©tait s√©lectionn√©e dans le graphique, la d√©s√©lectionner
                if (selectedRangeName === name) {
                    selectedRangeName = null;
                    document.getElementById('rangeSelector').value = '';
                    document.getElementById('rangeStatsDisplay').innerHTML = '';
                    document.getElementById('picsCreuxSection').style.display = 'none';
                    document.getElementById('chutesMonteeSection').style.display = 'none';
                    document.getElementById('picsCreuxLegersSection').style.display = 'none';
                    document.getElementById('plateauxSection').style.display = 'none';
                    document.getElementById('thermometreSection').style.display = 'none';
                    document.getElementById('classementSection').style.display = 'none';
                    document.getElementById('predictionSection').style.display = 'none';
                    if (rangeChart) {
                        rangeChart.data.labels = [];
                        rangeChart.data.datasets[0].data = [];
                        rangeChart.data.datasets[1].data = [];
                        rangeChart.update('none');
                    }
                    document.getElementById('chartLegend').innerHTML = '';
                }
                
                if (isConnected) {
                    socket.emit('message', { type: 'saveRanges', ranges: currentRanges });
                }
            }
        }

        // Utilitaires
        function updateLastUpdated() {
            document.getElementById('lastUpdated').innerHTML = `<i class="far fa-clock"></i> Mise √† jour: ${new Date().toLocaleTimeString()}`;
        }

        function toggleSettings() {
            const panel = document.querySelector('.settings-panel');
            panel.classList.toggle('collapsed');
            
            const icon = document.querySelector('#toggleSettings i');
            if (panel.classList.contains('collapsed')) {
                icon.className = 'fas fa-chevron-down';
            } else {
                icon.className = 'fas fa-chevron-up';
            }
        }

        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('authToken');
            const icon = document.querySelector('.toggle-password i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.className = 'fas fa-eye-slash';
            } else {
                passwordInput.type = 'password';
                icon.className = 'fas fa-eye';
            }
        }

        function updateColorPreview() {
            const color = document.getElementById('rangeColor').value;
            document.getElementById('colorPreview').style.backgroundColor = color;
        }

        function afficherNotification(message, couleur = "#2d3436") {
            const notif = document.getElementById('serverNotification');
            notif.textContent = message;
            notif.style.backgroundColor = couleur;
            notif.style.left = "20px";
            notif.style.opacity = "1";

            notif.style.transition = "all 0.5s ease";

            setTimeout(() => {
                notif.style.left = "-300px";
                notif.style.opacity = "0";
            }, 3000);
        }
    </script>
</body>
</html>
